#textdomain wesnoth-loti

#undef NEW_GOLD_CARRYOVER_NOTE_20
#undef NEW_GOLD_CARRYOVER_NOTE_60
#undef NEW_GOLD_CARRYOVER_NOTE_80
#undef DAWN1
#undef DAWN2
#undef MORNING1
#undef MORNING2
#undef MIDDAY1
#undef MIDDAY2
#undef AFTERNOON1
#undef AFTERNOON2
#undef MIDDAY1
#undef MIDDAY2
#undef DUSK1
#undef DUSK2
#undef SHORTDARK
#undef LONGDARK1
#undef LONGDARK2
#undef LONGDARK3
#undef LONGDARK4
#undef TWO_SUNS_DEFAULT_SCHEDULE

#define UPDATE_STATS
    [update_stats]
        x,y=$x1,$y1
    [/update_stats]
#enddef

#define MAKE_BLACK_SOUL
    [fire_event]
        name=make black soul
    [/fire_event]
#enddef

#define NEW_GOLD_CARRYOVER_NOTE_20
    _"
20% of finishing gold carried over to the next scenario."#enddef

#define NEW_GOLD_CARRYOVER_NOTE_80
    _"
80% of finishing gold carried over to the next scenario."#enddef

#define NEW_GOLD_CARRYOVER_NOTE_60
    _"
60% of finishing gold carried over to the next scenario."#enddef

#define CHAPTER_TITLE BACKGROUND NUMBER IMAGE_MOD COMMENT
    [story]
        [part]
            background={BACKGROUND}~BLIT(chapter-text.png{IMAGE_MOD})~BLIT(chapter-text-{NUMBER}.png{IMAGE_MOD})
            story={COMMENT}
        [/part]
    [/story]
#enddef

#define NO_FAST_AI
    [event]
        name=prestart
        {VARIABLE no_fast_ai yes}
    [/event]
    [event]
        name=victory
        {CLEAR_VARIABLE no_fast_ai}
    [/event]
#enddef

#define ACHIEVED_5_AMLAS
    [advancement]
        id=backup_amla
    [/advancement]
    [advancement]
        id=backup_amla
    [/advancement]
    [advancement]
        id=backup_amla
    [/advancement]
    [advancement]
        id=backup_amla
    [/advancement]
    [advancement]
        id=backup_amla
    [/advancement]
#enddef
#define GENERIC_DEATHS
    [event]
        name=last breath
        [filter]
            id=Lethalia
        [/filter]
        [message]
            speaker=Efraim
            message= _ "No!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Efraim
        [/filter]
        [message]
            speaker=Lethalia
            message= _ "No!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
#enddef
#define MODIFY_SIDE SIDE VAR TO_VAR
    [modify_side]
        side={SIDE}
        {VAR}={TO_VAR}
    [/modify_side]
#enddef
#define GOLD_CHEST X Y
    {PLACE_IMAGE items/chest-plain-closed.png {X} {Y}}
    [event]
        name=moveto
        id=utils_chest_event_{X}_{Y}
        [filter]
            side=$allied_sides
            x,y={X},{Y}
        [/filter]
        [sound]
            name=gold.ogg
        [/sound]
        [message]
            speaker=unit
            message= _ "I have found some gold."
        [/message]
        {VARIABLE gold_amount "$(2d50)"}
        [gold]
            side=$side_number
            amount=$gold_amount
        [/gold]
        {CLEAR_VARIABLE gold_amount}
        [remove_item]
            x,y={X},{Y}
            image=items/chest-plain-closed.png
        [/remove_item]
        {PLACE_IMAGE items/chest-plain-open.png {X} {Y}}
    [/event]

#enddef
#define SCHEDULE_HELL
    [time]
        id=hell
        name= _ "Hell"
        image=misc/schedule-hell.png
        lawful_bonus=0
        red=20
        green=-15
        blue=-20
    [/time]
#enddef
#define SCHEDULE_FLAMING_SKY
    [time]
        id=flaming_sky
        name= _ "Flaming skies"
        image=misc/schedule-fire.png
        lawful_bonus=0
        red=50
        green=20
        blue=0
    [/time]
#enddef
#define GUARDIAN_UNIT SIDE TYPE X Y
    [unit]
        side={SIDE}
        type={TYPE}
        x={X}
        y={Y}
        generate_name=yes
        random_traits=yes
        random_gender=yes
        upkeep=full
        ai_special=guardian
    [/unit]
#enddef
#define BUY_GEM VAR COST
    [show_if]
        [variable]
            name=gold
            greater_than_equal_to={COST}
        [/variable]
    [/show_if]
    [command]
        {VARIABLE_OP {VAR} add 1}
        [gold]
            side=$unit.side
            amount=-{COST}
        [/gold]
    [/command]
#enddef
#define SELL_GEMS
    [option]
        label=_"Buy an obsidian for 5 gold (currently having $obsidians of them)"
        {BUY_GEM obsidians 5}
    [/option]
    [option]
        label=_"Buy a topaz for 9 gold (currently having $topazes of them)"
        {BUY_GEM topazes 9}
    [/option]
    [option]
        label=_"Buy an opal for 16 gold (currently having $opals of them)"
        {BUY_GEM opals 16}
    [/option]
    [option]
        label=_"Buy a pearl for 30 gold (currently having $pearls of them)"
        {BUY_GEM pearls 30}
    [/option]
    [option]
        label=_"Buy a diamond for 55 gold (currently having $diamonds of them)"
        {BUY_GEM diamonds 55}
    [/option]
    [option]
        label=_"Buy a ruby for 100 gold (currently having $rubies of them)"
        {BUY_GEM rubies 100}
    [/option]
    [option]
        label=_"Buy an emerald for 200 gold (currently having $emeralds of them)"
        {BUY_GEM emeralds 200}
    [/option]
    [option]
        label=_"Buy an amethyst for 500 gold (currently having $amethysts of them)"
        {BUY_GEM amethysts 500}
    [/option]
    [option]
        label=_"Buy a sapphire for 1000 gold (currently having $sapphires of them)"
        {BUY_GEM sapphires 1000}
    [/option]
    [option]
        label=_"Buy a black pearl for 2000 gold (currently having $black_pearls of them)"
        {BUY_GEM black_pearls 2000}
    [/option]
#enddef
#define SHOP_ITEM NAME PRICE NUMBER IMAGE VARIABLE_NAME
    [option]
        label={NAME} + " (" + {PRICE} + _" gold)"
        image={IMAGE}
        [command]
            [loti_item_type]
                number={NUMBER}
                to_variable=item_info
            [/loti_item_type]
            [message]
                id=trader
                [or]
                    id=trader1
                [/or]
                [or]
                    id=trader2
                [/or]
                [or]
                    id=trader3
                [/or]
                message= _ "Look at it. Do you really want it?
$item_info.description"
                [option]
                    label= _ "Yes."
                    [command]
                        [if]
                            [variable]
                                name=gold
                                greater_than_equal_to={PRICE}
                            [/variable]
                            [else]
                                [message]
                                    speaker=trader
                                    message= _ "You do not have enough gold. Listen, if I sold it to you for less gold, I would not have enough gold to bribe the enemies to leave me alone."
                                [/message]
                            [/else]
                            [then]
                                {PLACE_ITEM {NUMBER} $x1 $y1}
                                [gold]
                                    side=$side_number
                                    amount=-{PRICE}
                                [/gold]
                                {VARIABLE_OP items_dropped add 1}
                                {VARIABLE {VARIABLE_NAME} 1}
                                [fire_event]
                                    name=item_pick
                                    [primary_unit]
                                        x,y=$x1,$y1
                                    [/primary_unit]
                                [/fire_event]
                            [/then]
                        [/if]
                    [/command]
                [/option]
                [option]
                    label= _ "No."
                    [command]
                    [/command]
                [/option]
            [/message]
            {CLEAR_VARIABLE item_info}
        [/command]
        [show_if]
            [variable]
                name={VARIABLE_NAME}
                not_equals=1
            [/variable]
        [/show_if]
    [/option]
#enddef

#define TRAIT_HIGHLANDER
    [trait]
        id=healthy
        male_name= _"highlander"
        female_name= _"female^highlander"
        generate_description=false
        description= _"Born better than others, 5 more hitpoints + 3 more per level, 1 more damage per level, heals 2 HP every turn"
        [effect]
            apply_to=hitpoints
            increase_total=5
        [/effect]
        [effect]
            apply_to=hitpoints
            times=per level
            increase_total=3
        [/effect]
        [effect]
            apply_to=attack
            times=per level
            increase_damage=1
        [/effect]
    [/trait]
#enddef

#define CAMPAIGN3_DEATH_MESSAGES
    [event]
        name=last breath
        [filter]
            id=Lethalia
        [/filter]
        [message]
            speaker=unit
            message= _ "I wanted no live nearly forever, and the word 'nearly' meant millenia. But not some unlucky three hundred and thirty years."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Efraim
        [/filter]
        [message]
            speaker=unit
            message= _ "Stupid adventure..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Argan
        [/filter]
        [message]
            speaker=unit
            message= _ "I am dead and destroyed, and legends about me shall start appearing..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Delly
        [/filter]
        [message]
            speaker=unit
            message= _ "No! My life was prolonged, yes, but why only for four years?"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Stormrider
        [/filter]
        [message]
            speaker=unit
            message= _ "No! I have duties to complete."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=prerecruit
        first_time_only=no
        [filter]
            [not]
                type=Thug
                [or]
                    type=Bandit
                [/or]
                [or]
                    type=Highwayman
                [/or]
                [or]
                    type=Poacher
                [/or]
                [or]
                    type=Trapper
                [/or]
                [or]
                    type=Huntsman
                [/or]
                [or]
                    type=Ranger
                [/or]
                [or]
                    type=Thief
                [/or]
                [or]
                    type=Rogue
                [/or]
                [or]
                    type=Assassin
                [/or]
            [/not]
        [/filter]
        {VARIABLE unit.variables.chapter 3}
        [unstore_unit]
            variable=unit
            find_vacant=no
        [/unstore_unit]
        [object]
            # Chapter3 loyal experience
            duration=forever
            silent=yes
            [filter]
                x,y=$x1,$y1
            [/filter]

            [effect]
                apply_to=max_experience
                increase=-20%
            [/effect]
        [/object]
    [/event]
#enddef
#define RECALL_HEROES_DIRECT
    [recall]
        id=Delly
    [/recall]
    [recall]
        id=Lethalia
    [/recall]
    [recall]
        id=Stormrider
    [/recall]
    [recall]
        id=Argan
    [/recall]

    [store_unit]
        [filter]
            [filter_wml]
                [variables]
                    chapter=3
                [/variables]
            [/filter_wml]
        [/filter]

        kill=no
        variable=units_to_recall
    [/store_unit]

    {FOREACH units_to_recall i}
        [recall]
            id=$units_to_recall[$i].id
        [/recall]
    {NEXT i}
    {CLEAR_VARIABLE units_to_recall}
#enddef
#define RECALL_HEROES
    [event]
        name=prestart
        {RECALL_HEROES_DIRECT}
    [/event]
#enddef

#define SCHEDULE_FIMBULWINTER
    [time]
        id=fimbulwinter_dawn
        name= _ "Fimbulwinter Dawn"
        image=misc/schedule-snowstorm-twilight.png
        lawful_bonus=-15
        red=-40
        green=-40
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_day
        name= _ "Fimbulwinter Day"
        image=misc/schedule-snowstorm-day.png
        lawful_bonus=10
        red=-20
        green=-20
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_day
        name= _ "Fimbulwinter Day"
        image=misc/schedule-snowstorm-day.png
        lawful_bonus=10
        red=-20
        green=-20
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_day
        name= _ "Fimbulwinter Day"
        image=misc/schedule-snowstorm-day.png
        lawful_bonus=10
        red=-20
        green=-20
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_dusk
        name= _ "Fimbulwinter Dusk"
        image=misc/schedule-snowstorm-twilight.png
        lawful_bonus=-15
        red=-40
        green=-40
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_night
        name= _ "Fimbulwinter Night"
        image=misc/schedule-snowstorm-night.png
        lawful_bonus=-40
        red=-55
        green=-50
        blue=-30
    [/time]
    [time]
        id=fimbulwinter_dawn
        name= _ "Fimbulwinter Dawn"
        image=misc/schedule-snowstorm-twilight.png
        lawful_bonus=-15
        red=-40
        green=-40
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_day
        name= _ "Fimbulwinter Day"
        image=misc/schedule-snowstorm-day.png
        lawful_bonus=10
        red=-20
        green=-20
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_day
        name= _ "Fimbulwinter Day"
        image=misc/schedule-snowstorm-day.png
        lawful_bonus=10
        red=-20
        green=-20
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_day
        name= _ "Fimbulwinter Day"
        image=misc/schedule-snowstorm-day.png
        lawful_bonus=10
        red=-20
        green=-20
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_dusk
        name= _ "Fimbulwinter Dusk"
        image=misc/schedule-snowstorm-twilight.png
        lawful_bonus=-15
        red=-40
        green=-40
        blue=-20
    [/time]
    [time]
        id=fimbulwinter_night
        name= _ "Fimbulwinter Night"
        image=misc/schedule-snowstorm-night.png
        lawful_bonus=-40
        red=-55
        green=-50
        blue=-30
    [/time]
    [time]
        id=fimbulwinter_night
        name= _ "Fimbulwinter Night"
        image=misc/schedule-snowstorm-night.png
        lawful_bonus=-40
        red=-55
        green=-50
        blue=-30
    [/time]
    [time]
        id=fimbulwinter_night
        name= _ "Fimbulwinter Night"
        image=misc/schedule-snowstorm-night.png
        lawful_bonus=-40
        red=-55
        green=-50
        blue=-30
    [/time]
    [time]
        id=fimbulwinter_night
        name= _ "Fimbulwinter Night"
        image=misc/schedule-snowstorm-night.png
        lawful_bonus=-40
        red=-55
        green=-50
        blue=-30
    [/time]
#enddef

#define DESERT_SUN
    [time]
        id=dawn_desert_loti
        name= _ "Dawn"
        image=misc/time-schedules/default/schedule-dawn.png
        red=-15
        green=-15
        sound=ambient/morning.ogg
        lawful_bonus=5
    [/time]
    [time]
        id=morning_desert_loti
        name= _ "Morning"
        image=misc/time-schedules/default/schedule-morning.png
        lawful_bonus=30
        red=5
        green=5
    [/time]
    [time]
        id=afternoon_desert_loti
        name= _ "Afternoon"
        image=misc/time-schedules/default/schedule-afternoon.png
        lawful_bonus=30
        red=5
        green=5
    [/time]
    [time]
        id=dusk_desert_loti
        name= _ "Dusk"
        image=misc/time-schedules/default/schedule-dusk.png
        green=-15
        blue=-15
        sound=ambient/night.ogg
        lawful_bonus=5
    [/time]
    [time]
        id=first_watch_desert_loti
        name= _ "First Watch"
        image=misc/time-schedules/default/schedule-firstwatch.png
        lawful_bonus=-20
        red=-35
        green=-35
        blue=-10
    [/time]
    [time]
        id=second_watch_desert_loti
        name= _ "Second Watch"
        image=misc/time-schedules/default/schedule-secondwatch.png
        lawful_bonus=-20
        red=-35
        green=-35
        blue=-10
    [/time]
#enddef
#define AI_OVERHAUL_PLACE SIDE

    [ai]
        aggression=1.0
    [/ai]
    # The micro AI is added elsewhere

#enddef
#define AI_OVERHAUL_PLACE_2 SIDE

    [ai]
        aggression=1.0
    [/ai]

#enddef

#define AI_LEAVE_THE_LEADERS SIDE
    [ai]
        {MODIFY_AI_ADD_ASPECT {SIDE} attacks (
            [facet]
                name=testing_ai_default::aspect_attacks
                id=dont_attack_Lethalia
                invalidate_on_gamestate_change=yes
                [filter_enemy]
                    [not]
                        id=Lethalia
                    [/not]
                    [not]
                        id=Efraim
                    [/not]
                [/filter_enemy]
            [/facet]
        )}
    [/ai]
#enddef

#define DISABLE_UPKEEP SIDE
    [event]
        name=unit placed
        first_time_only=no
        [filter]
            side={SIDE}
        [/filter]
        [filter_condition]
            [variable]
                name=unit.upkeep
                not_equals=loyal
            [/variable]
        [/filter_condition]
        [modify_unit]
            [filter]
                find_in=unit
            [/filter]
            [variables]
                original_upkeep=$this_unit.upkeep
            [/variables]
            upkeep=loyal
        [/modify_unit]
        [deny_undo]
        [/deny_undo]
    [/event]
    [event]
        name=victory
        [modify_unit]
            [filter]
                side={SIDE}
            [/filter]
            [filter_condition]
                [variable]
                    name=$this_unit.variables.original_upkeep
                    not_equals=
                [/variable]
            [/filter_condition]
            upkeep=$this_unit.variables.original_upkeep
            [variables]
                original_upkeep=
            [/variables]
        [/modify_unit]
    [/event]
    [event]
        name=prestart
        [modify_side]
            side={SIDE}
            village_gold=0
            income=-2
        [/modify_side]
    [/event]
#enddef

#define DAWN1
    [time]
        id=dawn1
        name= _ "First Dawn"
        image=misc/time/1dawn1.png
        red=-20
        green=-20
    [/time]
#enddef

#define DAWN2
    [time]
        id=dawn2
        name= _ "Second Dawn"
        image=misc/time/7dawn2.png
        red=-20
        green=-20
    [/time]
#enddef

#define MORNING1
    [time]
        id=morning1
        name= _ "First Morning"
        image=misc/time/2morning1.png
        lawful_bonus=25
    [/time]
#enddef

#define MORNING2
    [time]
        id=morning2
        name= _ "Second Morning"
        image=misc/time/8morning2.png
        lawful_bonus=25
    [/time]
#enddef

#define MIDDAY1
    [time]
        id=midday1
        name= _ "First Midday"
        image=misc/time/3midday1.png
        lawful_bonus=25
    [/time]
#enddef

#define MIDDAY2
    [time]
        id=midday2
        name= _ "Second Midday"
        image=misc/time/9midday2.png
        lawful_bonus=25
    [/time]
#enddef

#define AFTERNOON1
    [time]
        id=afternoon1
        name= _ "First Afternoon"
        image=misc/time/4afternoon1.png
        lawful_bonus=25
    [/time]
#enddef

#define AFTERNOON2
    [time]
        id=afternoon2
        name= _ "Second Afternoon"
        image=misc/time/10afternoon2.png
        lawful_bonus=25
    [/time]
#enddef

#define DUSK1
    [time]
        id=dusk1
        name= _ "First Dusk"
        image=misc/time/5dusk1.png
        green=-20
        blue=-20
    [/time]
#enddef

#define DUSK2
    [time]
        id=dusk2
        name= _ "Second Dusk"
        image=misc/time/11dusk2.png
        green=-20
        blue=-20
    [/time]
#enddef

#define SHORTDARK
    [time]
        id=short_dark
        name= _ "Short Dark"
        image=misc/time/6shortdark.png
        lawful_bonus=-25
        red=-40
        green=-40
        blue=-10
    [/time]
#enddef

#define LONGDARK1
    [time]
        id=long_dark1
        name= _ "Long Dark (1)"
        image=misc/time/12longdark1.png
        lawful_bonus=-25
        red=-40
        green=-40
        blue=-10
    [/time]
#enddef

#define LONGDARK2
    [time]
        id=long_dark2
        name= _ "Long Dark (2)"
        image=misc/time/13longdark2.png
        lawful_bonus=-25
        red=-40
        green=-40
        blue=-10
    [/time]
#enddef

#use same image as second watch

#define LONGDARK3
    [time]
        id=long_dark3
        name= _ "Long Dark (3)"
        image=misc/time/14longdark3.png
        lawful_bonus=-25
        red=-40
        green=-40
        blue=-10
    [/time]
#enddef

#define LONGDARK4
    [time]
        id=long_dark4
        name= _ "Long Dark (4)"
        image=misc/time/15longdark4.png
        lawful_bonus=-25
        red=-40
        green=-40
        blue=-10
    [/time]
#enddef

#define TWO_SUNS_DEFAULT_SCHEDULE
    {DAWN1}
    {MORNING1}
    {MIDDAY1}
    {AFTERNOON1}
    {DUSK1}
    {SHORTDARK}
    {DAWN2}
    {MORNING2}
    {MIDDAY2}
    {AFTERNOON2}
    {DUSK2}
    {LONGDARK1}
    {LONGDARK2}
    {LONGDARK3}
    {LONGDARK4}
#enddef

#define TEXT_COUNT VARIABLE_NAME FROM TO
    [if]
        [variable]
            name={VARIABLE_NAME}
            equals="{FROM}"
        [/variable]
        [then]
            {VARIABLE {VARIABLE_NAME} {TO}}
        [/then]
    [/if]
#enddef

#define UPDATE_ATTACKS X Y
    # This is some kind of UPDATE_STATS that happens on a settable location

    [update_stats]
        x,y={X},{Y}
    [/update_stats]
#enddef

#define VAMPIRE_TRANSFORMATION ORIGINAL TRANSFORMED SIDE
    # The definition of vampirism is quite simple. If a unit is hit by a unit allegiant to a vampiric side, it has a 2% chance to advance to a vampiric
    # unit (type depending on its original type) and change the side to the vampiric side. Level 3 and higher units are not affected.
    [event]
        name=attacker hits
        first_time_only=no

        [filter]
            side={SIDE}
        [/filter]
        [filter_second]
            type={ORIGINAL}
        [/filter_second]
        {VARIABLE_OP did_transform rand (0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1)}
        [if]
            [variable]
                name=did_transform
                numerical_equals=1
            [/variable]
            [then]
                {ADVANCE_UNIT x,y=$x2,$y2 {TRANSFORMED}}
                {MODIFY_UNIT x,y=$x2,$y2 side {SIDE}}
            [/then]
        [/if]
    [/event]
    [event]
        name=defender hits
        first_time_only=no

        [filter]
            type={ORIGINAL}
        [/filter]
        [filter_second]
            side={SIDE}
        [/filter_second]
        {VARIABLE_OP did_transform rand (0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1)}
        [if]
            [variable]
                name=did_transform
                numerical_equals=1
            [/variable]
            [then]
                {ADVANCE_UNIT x,y=$x1,$y1 {TRANSFORMED}}
                {MODIFY_UNIT x,y=$x1,$y1 side {SIDE}}
            [/then]
        [/if]
        {CLEAR_VARIABLE did_transform}
    [/event]
#enddef
#define VAMPIRISM SIDE
    {VAMPIRE_TRANSFORMATION "Peasant" "Vampire Spearman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Ruffian" "Vampire Spearman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Thug" "Vampire Spearman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Thief" "Vampire Fencer" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Footpad" "Vampire Fencer" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Poacher" "Vampire Bowman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Trapper" "Vampire Longbowman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Outlaw" "Vampire Duelist" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Rogue" "Vampire Duelist" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Bandit" "Vampire Swordsman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Royal Guard" "Vampire Guard" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Master at Arms" "Vampire Master" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Master Bowman" "Vampire Master Bowman" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Iron Mauler" "Vampire Iron Mauler" {SIDE}}
    {VAMPIRE_TRANSFORMATION "Cavalier" "Vampire Cavalier" {SIDE}}
#enddef
#define LEGACY_MESSAGE_OPTIONS VARIABLE_NAME
    [option]
        label= _ "I am a descendant of an ancient king, but that was generations ago. I am not even sure that it isn't just something my grandparents made up."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_kings}
        [/command]
    [/option]
    [option]
        label= _ "My parents say that my ancestors were greatgreatgreatgreat-blahblahblah-greatgreatgrandsons of some god or demigod or something."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_light}
        [/command]
    [/option]
    [option]
        label= _ "A bard told me that I have a great fire dragon in my family tree. He shapeshifted into a man once and all of his descendants are as strong as dragons."
        [command]
            {VARIABLE {VARIABLE_NAME} fire_dragon_legacy}
        [/command]
    [/option]
    [option]
        label= _ "I can feel in my blood that I am descendant of the Titans, mighty men who walked this world when it was reshaped by our gods."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_titans}
        [/command]
    [/option]
    [option]
        label= _ "Judging from my love for cold weather, I must have an ice dragon in my family tree."
        [command]
            {VARIABLE {VARIABLE_NAME} ice_dragon_legacy}
        [/command]
    [/option]
    [option]
        label= _ "My bloodline was hardened by many sorrowful events that plagued my ancestors. I am the descendant of those who survived all the hardships."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_sorrow}
        [/command]
    [/option]
    [option]
        label= _ "A sorcerer once told me that one of my ancestors was spawned by a dark dragon and thus I have a talent for dark powers."
        [command]
            {VARIABLE {VARIABLE_NAME} dark_dragon_legacy}
        [/command]
    [/option]
    [option]
        label= _ "Some of my ancestors were vampires. But that was long ago."
        [command]
            {VARIABLE {VARIABLE_NAME} undead_legacy}
        [/command]
    [/option]
    [option]
        label= _ "I was told that one of my forefathers was resurrected by a legendary immortal bird called phoenix, maybe I still have something of his gift."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_phoenix}
        [/command]
    [/option]
    [option]
        label= _ "My distant grandfather was a tyrant, he was overthrown and my ancestors thus spend a many generation in exile in wilderness."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_exile}
        [/command]
    [/option]
    [option]
        label= _ "I come from frozen wastelands far away to the north from here."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_the_freezing_north}
        [/command]
    [/option]
    [option]
        label= _ "My ancestors were travellers, travelled across the whole continent, unrestrained, unbound, unlimited by any rulers or laws."
        [command]
            {VARIABLE {VARIABLE_NAME} legacy_of_the_free}
        [/command]
    [/option]
#enddef
#define BEELZEBUB_SPAWN_POINT SIDE POWER X Y XY_RANGE
    [side]
        no_leader=yes
        side={SIDE}
        team_name=unknown
        user_team_name=_"Unknown"
        [ai]
            aggression=1.0
        [/ai]
    [/side]
    [event]
        name=start
        [filter_condition]
            [variable]
                name=saved_turns
                greater_than_equal_to=500
            [/variable]
        [/filter_condition]
        {PLACE_IMAGE scenery/monolith3.png {X} {Y}}
        [event]
            name=moveto
            [filter]
                side=1
                x,y={XY_RANGE}
            [/filter]
            [if]
                [variable]
                    name=seen_beelzebub_monument
                    equals=yes
                [/variable]
                [then]
                    [message]
                        speaker=unit
                        message= _ "Look..."
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "Oh damn. Beelzebub is here again."
                    [/message]
                [/then]
                [else]
                    [message]
                        speaker=unit
                        message= _ "Look! That stone looks quite weird."
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "Maybe we should investigate."
                    [/message]
                    {VARIABLE seen_beelzebub_monument true}
                [/else]
            [/if]
        [/event]
        [event]
            name=moveto
            id=spawn_beelzebub
            first_time_only=no
            [filter]
                side=1
                x,y={X},{Y}
            [/filter]
            [if]
                [variable]
                    name=seen_beelzebub_monument_close
                    equals=yes
                [/variable]
                [then]
                    [message]
                        speaker=unit
                        message= _ "This is indeed left behind by Beelzebub."
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "This makes me think if we want to see him again."
                    [/message]
                [/then]
                [else]
                    [message]
                        speaker=unit
                        message= _ "Some strange letters are inscribed on this monument. It says... <i>ROTFL, BRB, LOL</i>."
                    [/message]
                    [message]
                        id=Efraim
                        [or]
                            id=Krux
                        [/or]
                        message= _ "I have seen these shortcuts before... What was it, Lethalia, can you remember?"
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "Let me think... <i>ROTFL</i> stands for <i>Rule on till forever, Lilith</i>. <i>LOL</i> means <i>Lilith our Leader</i>. <i>BRB</i> is a shortcut of <i>Beelzebub rules below</i>. Beelzebub... I have heard of that one. This is his motto, if I recall correctly. Somebody has been venerating demons here. Really foul magic."
                    [/message]
                    [message]
                        id=Efraim
                        [or]
                            id=Krux
                        [/or]
                        message= _ "For what ends? Why do the demons need veneration? What do people get for it?"
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "If I recall correctly, these stones can be used like extensions of the demons' presence. The demon can use them to appear near any of them whenever he wants, and see what is around the stone. They have to be created by locals, demons cannot create them so that they would work in this world. Maybe the demon forced someone to create this. But why is the demon here...?"
                    [/message]
                    [message]
                        id=Efraim
                        [or]
                            id=Krux
                        [/or]
                        message= _ "Maybe someone summoned them to destroy us."
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "It's really horrible if a strong demon is present here. Imagine how much havoc can one such demon spread. We might not be the target, the demon is not coming."
                    [/message]
                    [message]
                        id=Efraim
                        [or]
                            id=Krux
                        [/or]
                        message= _ "Maybe the demon is bad at looking for us."
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "Maybe we could willingly allow the demon to come by, to save others from destruction. Some demons are fabled to wear ancient artefacts of power, so we might just want to fight for material gain."
                    [/message]
                    {VARIABLE seen_beelzebub_monument_close true}
                [/else]
            [/if]
            [message]
                id=Efraim
                [or]
                    id=Krux
                [/or]
                message= _ "So what, shall we touch it to attract him?"
                [option]
                    label=_"Touch it. We must stop the creature."
                    [command]
                        [remove_event]
                            id=spawn_beelzebub
                        [/remove_event]
                        {QUAKE "rumble.ogg"}
                        {EARTHQUAKE (
                            [unit]
                                canrecruit=yes
                                id=Beelzebub
                                name=_"Beelzebub"
                                type=Beelzebub
                                side={SIDE}
                                x,y={X},{Y}
                                [variables]
                                    bonus_boss=yes
                                [/variables]
                                to_variable=beel_store
                            [/unit]
                        )}
                        [unstore_unit]
                            variable=beel_store
                            find_vacant=yes
                        [/unstore_unit]
                        {VARIABLE beel_store_level_add {POWER}}
                        {VARIABLE_OP beel_store_level_add multiply 5}
                        [object]
                            silent=yes
                            [filter]
                                id=Beelzebub
                            [/filter]
                            [effect]
                                apply_to=level
                                set="$($beel_store.level + $beel_store_level_add)"
                            [/effect]
                            [effect]
                                apply_to=status
                                add=not_living
                            [/effect]
                        [/object]
                        {CLEAR_VARIABLE beel_store,beel_store_level_add}
                        {REPEAT {POWER} (
                            [object]
                                silent=yes
                                [filter]
                                    id=Beelzebub
                                [/filter]
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=20%
                                    increase=20%
                                [/effect]
                                [effect]
                                    apply_to=attack
                                    increase_damage=20%
                                [/effect]
                            [/object]
                        )}
                        {QUAKE "rumble.ogg"}
                        [message]
                            speaker=Beelzebub
                            message= _ "I have found you, sneaky weaklings."
                        [/message]
                        [if]
                            [variable]
                                name=seen_beelzebub
                                equals=yes
                            [/variable]
                            [else]
                                [message]
                                    id=Lethalia
                                    [or]
                                        id=Vritra
                                    [/or]
                                    message= _ "We were not hiding."
                                [/message]
                                [message]
                                    speaker=Beelzebub
                                    message= _ "Are you so foolish?"
                                    [option]
                                        label=_"You are told to possess all kinds of objects we seek. We want to take them from your dead body."
                                        [command]
                                            [message]
                                                speaker=Beelzebub
                                                message= _ "Ha, you think you can kill me? So come, meet your end!"
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        label=_"We need to stop you from wreaking havoc all around."
                                        [command]
                                            [message]
                                                speaker=Beelzebub
                                                message= _ "You dare to defy me? We shall see how you will cry for mercy and receive none."
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        label=_"We seek a challenge. All other enemies were too easy."
                                        [command]
                                            [message]
                                                speaker=Beelzebub
                                                message= _ "I will be your last challenge. I will enjoy your demise."
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        label=_"We have forgotten to hide."
                                        [command]
                                            [message]
                                                speaker=Beelzebub
                                                message= _ "You are more foolish than I thought. Your sentence is death."
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        label=_"Stories go that demons are a bonne bouche!"
                                        [command]
                                            [message]
                                                speaker=Beelzebub
                                                message= _ "No one ever tasted any of it. You shall not change it. I will eat you alive!"
                                            [/message]
                                        [/command]
                                    [/option]
                                [/message]
                                {VARIABLE seen_beelzebub true}
                            [/else]
                        [/if]
                        [remove_event]
                            id=spawn_beelzebub
                        [/remove_event]
                    [/command]
                [/option]
                [option]
                    label=_"Let it be. We have worse problems to deal with first."
                    [command]
                        [message]
                            id=Efraim
                            [or]
                                id=Krux
                            [/or]
                            message= _ "Well, let us slip by."
                        [/message]
                    [/command]
                [/option]
            [/message]
        [/event]
        [event]
            name=turn refresh
            first_time_only=no
            [store_unit]
                [filter]
                    type=Beelzebub
                    side=$side_number
                [/filter]
                variable=beel_store
                kill=no
            [/store_unit]
            {FOREACH beel_store i}
                {REPEAT {POWER} (
                    [unit]
                        type=Flies
                        x,y=$beel_store[$i].x,$beel_store[$i].y
                        side=$side_number
                    [/unit]
                )}
            {NEXT i}
            {CLEAR_VARIABLE beel_store}
        [/event]
        [event]
            name=post advance
            [filter]
                type=Beelzebub
            [/filter]
            [store_unit]
                [filter]
                    type=Beelzebub
                [/filter]
                variable=beel_store
            [/store_unit]
            {VARIABLE beel_store_level_add {POWER}}
            {VARIABLE_OP beel_store_level_add multiply 5}
            {VARIABLE_OP beel_store.level add $beel_store_level_add}
            [unstore_unit]
                variable=beel_store
                find_vacant=no
            [/unstore_unit]
            {CLEAR_VARIABLE beel_store,beel_store_level_add}
        [/event]
        [event]
            name=die
            [filter]
                type=Beelzebub
            [/filter]
            [if]
                [variable]
                    name=seen_beelzebub_die
                    equals=yes
                [/variable]
                [then]
                    [message]
                        speaker=unit
                        message= _ "I shall return again. Much stronger than before. And you will learn what it truly means to suffer."
                    [/message]
                    [message]
                        id=Efraim
                        [or]
                            id=Krux
                        [/or]
                        message= _ "I wonder if there is a way to kill him for good."
                    [/message]
                [/then]
                [else]
                    [message]
                        speaker=unit
                        message= _ "I will have my revenge! I will rip your hearts out! I will count your ribs! I crack your skulls open and bite off your brain, bit by bit, while you still live! I will chew your guts and listen to your screams!"
                    [/message]
                    [message]
                        id=Lethalia
                        [or]
                            id=Vritra
                        [/or]
                        message= _ "How do you want to do it? You are defeated. You will not survive these injuries. You will not survive it because I will be chewing your ribs and ripping your skull out very soon. And the other things." # Deliberately confused
                    [/message]
                    {VARIABLE seen_beelzebub_die true}
                [/else]
            [/if]
            [store_locations]
                x,y=$x1,$y1
                radius=3
                variable=nearby
            [/store_locations]
            {RARE_ITEM $x1 $y1}
            {FOREACH nearby i}
                {DEFAULT_DROP_ITEM $nearby[$i].x $nearby[$i].y (axe,axe,staff,sword,sword,knife,bow,xbow,spear,spear,bow,dagger,mace)}
            {NEXT i}
            {CLEAR_VARIABLE nearby}
            {VARIABLE_OP saved_turns sub 500}
        [/event]
    [/event]
#enddef

#define RECALL_FROM_VARIABLE VAR X Y
    [if]
        [variable]
            name={VAR}.length
            greater_than_equal_to=1
        [/variable]
        [then]
            {VARIABLE question.speaker narrator}
            {VARIABLE question.message _"Choose a unit"}
            {VARIABLE question.image "wesnoth-icon.png"}
            {FOREACH {VAR} i}
                [if]
                    [variable]
                        name={VAR}[$i].name
                        equals=""
                    [/variable]
                    [then]
                        [set_variable]
                            name=name
                            value=${VAR}[$i].language_name
                        [/set_variable]
                    [/then]
                    [else]
                        [set_variable]
                            name=name
                            value=${VAR}[$i].name + _" (" + ${VAR}[$i].language_name + _")"
                        [/set_variable]
                    [/else]
                [/if]
                [set_variables]
                    name=question.option[$i]
                    mode=replace
                    delayed_variable_substitution=no
                    [value]
                        message=$name
                        [command]
                            {VARIABLE chose $i}
                        [/command]
                    [/value]
                [/set_variables]
            {NEXT i}
            [insert_tag]
                name=message
                variable=question
            [/insert_tag]
            [unstore_unit]
                variable={VAR}[$chose]
                x,y={X},{Y}
                find_vacant=yes
            [/unstore_unit]
            {CLEAR_VARIABLE {VAR}[$chose],question,chose,name}
        [/then]
        [else]
            [message]
                speaker=narrator
                image="wesnoth-icon.png"
                message=_"No units available."
            [/message]
        [/else]
    [/if]
#enddef

#define CH08G_OBSERVER SIDE TYPE X Y
    [unit]
        side={SIDE}
        type={TYPE}
        x={X}
        y={Y}
        generate_name=yes
        random_traits=yes
        random_gender=yes
        upkeep=loyal
        [modifications]
            [object]
                [effect]
                    apply_to=movement_costs
                    replace="true"
                    [movement_costs]
                        flat={UNREACHABLE}
                        sand={UNREACHABLE}
                        forest={UNREACHABLE}
                        village={UNREACHABLE}
                    [/movement_costs]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define REMOVE_TRAIT_BY_ID UNIT TRAIT_ID
    [for]
        array={UNIT}.modifications.trait
        [do]
            [if]
                [variable]
                    name={UNIT}.modifications.trait[$i].id
                    equals={TRAIT_ID}
                [/variable]
                [then]
                    {CLEAR_VARIABLE {UNIT}.modifications.trait[$i]}
                    {VARIABLE_OP i sub 1}
                [/then]
            [/if]
        [/do]
    [/for]
#enddef

#define GENERIC_UNIT_PASSABLE SIDE TYPE X Y
    # Copied from data/core/macros/unit-utils.cfg, with passable=yes added
    # Creates a generic unit of TYPE belonging to SIDE at X,Y, which has a
    # random name, gender and traits (just like a recruited unit).
    #
    [unit]
        side={SIDE}
        type={TYPE}
        x={X}
        y={Y}
        generate_name=yes
        random_traits=yes
        random_gender=yes
        upkeep=full
        passable=yes
    [/unit]
#enddef

