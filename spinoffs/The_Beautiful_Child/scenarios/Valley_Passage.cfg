#textdomain wesnoth-tbc
[scenario]
    id="Valley_Passage"
    name= _ "Valley Passage"
    map_data="{~add-ons/The_Beautiful_Child/maps/Valley_Passage.map}"
    next_scenario=07_Siege_of_Ziggurat
    victory_when_enemies_defeated=no
    turns=-1
    {DEFAULT_MUSIC_PLAYLIST}
    {DEFAULT_SCHEDULE_24H}

    [side]
        type=Swordsman
        id=player
        canrecruit=yes
        side=1
        controller=human
        recruit=
        village_gold=0
        income=-2
        gold=0
        team_name=good
        user_team_name=_"Good"
        shroud=yes
        fog=no
    [/side]
    [side]
        no_leader=yes
        side=2
        team_name=good,twisted_good
        user_team_name=_"Non-Combatants"
        ai_algorithm=idle_ai
    [/side]
    [side]
        no_leader=yes
        side=3
        team_name=good
        user_team_name=_"Good"
    [/side]
    [side]
        no_leader=yes
        side=4
        team_name=twisted_good
        user_team_name=_"Twisted Good"
        [ai]
            aggression=1
        [/ai]
    [/side]

    {TBC_PLACE_WAYPOINT 19 26}

    [event]
        name=prestart
        {CLEAR_RECALLS}
        {VARIABLE current_scenario valley_passage}
        {TBC_ORIGIN faithdome 50 5}
        {TBC_ORIGIN ziggurat_town 45 33}
        {TBC_TRANSITION 51-52 1-12 Faithdome _"Faithdome" 51 5}
        [if]
            [variable]
                name=quests.overall
                greater_than=14
            [/variable]
            [then]
                {TBC_TRANSITION 41-52 33-34 Ziggurat_Town _"Ziggurat Town" 45 33}
            [/then]
            [else]
                [unit]
                    side=2
                    x,y=49,33
                    type=Master at Arms
                    id=Konrad_II
                    name= _"Konrad II"
                    canrecruit=yes
                    [modifications]
                        [advancement]
                            id=portrait
                            [effect]
                                apply_to=profile
                                portrait="portraits/humans/transparent/fencer.png"
                            [/effect]
                        [/advancement]
                    [/modifications]
                [/unit]
            [/else]
        [/if]
    [/event]

    [event]
        name=start
        {TBC_GOLD_CHEST 47 24 valley_passage_cave_chest}
        [if]
            [variable]
                name=quests.entered_valley_passage
                equals=yes
            [/variable]
            [else]
                [message]
                    speaker=Rimaru
                    message=_"So, we are here, but where exactly is it and does it really exist?"
                [/message]
                [message]
                    speaker=wise_warrior
                    message=_"Never been there, but many people talked about it like if it was real. I know it's no evidence, but still..."
                [/message]
                [message]
                    speaker=Burke
                    message=_"I think that we should be afraid from enemies who penetrated through the enemy lines. This place isn't completely secure, there might be some fighting still."
                [/message]
                {VARIABLE quests.entered_valley_passage yes}
            [/else]
        [/if]
        [event]
            name=moveto
            first_time_only=no
            [filter]
                side=1
                x,y=40-51,31-34
            [/filter]
            [if]
                [variable]
                    name=quests.overall
                    less_than=13
                [/variable]
                [then]
                    [message]
                        speaker=Konrad_II
                        message=_"You have a mission to do if I recall correctly."
                    [/message]
                    [message]
                        speaker=unit
                        message=_"Yes, I know, but I need to ask you once again where the Hidden Valley is."
                    [/message]
                    [message]
                        speaker=Konrad_II
                        message=_"You should have written it down. It should be a cave passage that starts somewhere where the two rivers meet. If it doesn't exist, Luke will probably be near its entrance."
                    [/message]
                    [message]
                        speaker=unit
                        message=_"Thanks."
                    [/message]
                    [move_unit]
                        id=$unit.id
                        to_x=$x2
                        to_y=$y2
                        fire_event=no
                    [/move_unit]
                [/then]
                [else]
                    [if]
                        [have_unit]
                            id=Konrad_II
                        [/have_unit]
                        [then]
                            [message]
                                speaker=unit
                                message=_"Luke is dead."
                            [/message]
                            [message]
                                speaker=Konrad_II
                                message=_"Great! Now, their fractions will start fighting each other and they'll be much weaker. Let's exploit this leadership gap to invade Ziggurat."
                            [/message]
                            [message]
                                speaker=unit
                                message=_"Please send some diggers, the path to Hidden Valley was blocked by a cave-in that Luke used to prevent us from fleeing, unintentionally preventing himself from fleeing."
                            [/message]
                            [message]
                                speaker=Konrad_II
                                message=_"Interesting. Please tell me how did the fight go?"
                            [/message]
                            [endlevel]
                                result=victory
                                bonus=yes
                                {NEW_GOLD_CARRYOVER 100}
                            [/endlevel]
                        [/then]
                    [/if]
                [/else]
            [/if]
        [/event]
        [if]
            [variable]
                name=quests.overall
                less_than=14
            [/variable]
            [then]
                {TBC_SPAWN_UNITS_NO_LEADER 2 2 "Swordsman,Javelineer,Longbowman,Duelist,Spearman,Bowman,Fencer,Heavy Infantryman,Shock Trooper,Sword Mage,Cavalryman,Dragoon" 46 32}
                [event]
                    name=moveto
                    [filter]
                        side=1
                        x,y=9-22,1-17
                    [/filter]
                    [message]
                        speaker=unit
                        message=_"This is the Hidden Valley! Eureka!"
                    [/message]
                    [message]
                        speaker=Rimaru
                        message=_"Let's see if the bait worked."
                    [/message]
                    [unit]
                        type=Bringer of Light
                        id=Luke
                        name=_"Luke, The Bringer of Light"
                        canrecruit=yes
                        gender=male
                        side=4
                        x,y=18,7
                    [/unit]
                    {GENERIC_UNIT 4 "Mage of Light" 12 10}
#ifdef HARD
                    {GENERIC_UNIT 4 "Mage of Light" 19 11}
#endif
#ifndef EASY
                    {GENERIC_UNIT 4 "Mage of Light" 10 6}
#endif
                    {GENERIC_UNIT 4 "Mage of Light" 16 5}
                    [+unit]
                        id=mage_speaker
                    [/unit]
                    [store_unit]
                        [filter]
                            type=Mage of Light
                            side=4
                        [/filter]
                        variable=mages
                        kill=no
                    [/store_unit]
                    [for]
                        array=mages
                        [do]
                            [object]
                                silent=yes
                                [filter]
                                    id=$mages[$i].id
                                [/filter]
                                [effect]
                                    apply_to=attack
                                    [set_specials]
                                        [chance_to_hit]
                                            id=dazzle_counter
                                            value=30
                                            apply_to=opponent
                                            [filter_base_value]
                                                greater_than=30
                                            [/filter_base_value]
                                            [filter_opponent]
                                                [filter_wml]
                                                    [variables]
                                                        dazzled=yes
                                                    [/variables]
                                                [/filter_wml]
                                            [/filter_opponent]
                                        [/chance_to_hit]
                                    [/set_specials]
                                [/effect]
                            [/object]
                        [/do]
                    [/for]
                    {CLEAR_VARIABLE mages}
                    {VARIABLE i 24}
                    [while]
                        [variable]
                            name=i
                            greater_than=0
                        [/variable]
                        [do]
                            {GENERIC_UNIT 2 Peasant 20 8}
                            {VARIABLE_OP i sub 1}
                        [/do]
                    [/while]
                    {GENERIC_UNIT 2 "Peasant" 19 10}
                    [+unit]
                        id=peasant_speaker_1
                    [/unit]
                    {GENERIC_UNIT 2 "Peasant" 17 7}
                    [+unit]
                        id=peasant_speaker_2
                    [/unit]
                    [remove_shroud]
                        x,y=15,9
                        radius=7
                        side=1
                    [/remove_shroud]
                    {MOVE_SIDE_TO 1 17 12}
                    [message]
                        speaker=Luke
                        message=_"Work, dig in the ground, the ancient vault must be somewhere around here. If I was Niflheim the Horror from the Northern Wastelands, I would hide it somewhere around here."
                    [/message]
                    [message]
                        speaker=Burke
                        message=_"Hello, Luke. We came here to see you."
                    [/message]
                    [message]
                        speaker=hired_swordsman
                        message=_"Kill him!"
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"So you came here. I should have known your intentions, you're trying to steal the phoenix ash for yourself! If you find it, you'll pose a great threat to our order and to the entire kingdom!"
                    [/message]
                    [message]
                        speaker=Sicaria
                        message=_"There is no phoenix ash, we made that rumour in order to get you in a distant place where escape is uneasy. Now, we are going to kill you."
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"Fools! You will not deceive me with such cheap tricks. It is here and it is MINE. You will not have it because I will kill you now. Wait... aren't you Sicaria Homicide, by the way?"
                    [/message]
                    [message]
                        speaker=Sicaria
                        message=_"Yes, I am. I realised that the ring you gave me that is supposed to empower me when I kill the unrighteous just empowers me whenever I kill something. It seems that it steals souls. Just like you were, when you found me dying in that morgue. You're a soul stealer, of the worst kind. You disobeyed every single rule of your order..."
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"Shut up, nobody is interested in random stories you make up, girl. Write a book about that, maybe you'll turn out to be a good novel writer."
                        [option]
                            message=_"Luke, accept that we have found, trapped you and you have nothing to explain anymore, we all know about your wrongdoings."
                            [command]
                                [message]
                                    speaker=Rimaru
                                    message=_"Now, you've lost."
                                [/message]
                            [/command]
                        [/option]
                        [option]
                            message=_"Look at you. You have only a few allies here and we're in full force. There is no way to escape. You will die."
                            [command]
                                [message]
                                    speaker=Burke
                                    message=_"I am not an expert on war strategy, but I can easily tell whose forces are superior here."
                                [/message]
                            [/command]
                        [/option]
                        [option]
                            message=_"Tell me how to steal souls or I will torture you until you tell me that."
                            [command]
                                [message]
                                    speaker=Rimaru
                                    message=_"No, we will not torture and you will not learn the dark art of stealing souls."
                                [/message]
                                [message]
                                    speaker=Luke
                                    message=_"Ha ha ha... Join me. Be my apprentice!"
                                [/message]
                                [message]
                                    speaker=player
                                    message=_"I don't serve people like you!"
                                [/message]
                                [message]
                                    speaker=Luke
                                    message=_"So you won't learn anything."
                                [/message]
                                [message]
                                    speaker=Rimaru
                                    message=_"So be it. What matters is that you must die."
                                [/message]
                            [/command]
                        [/option]
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"Peasants. I will need you to understand the conception of divine sacrifice."
                    [/message]
                    [message]
                        speaker=peasant_speaker_1
                        message=_"I don't know what it is, but it sounds pretty grim."
                    [/message]
                    [message]
                        speaker=she_brother
                        message=_"I have a feeling that this will be really grim."
                    [/message]
                    [message]
                        speaker=mage_speaker
                        message=_"You plan to sacrifice yourself and let us die here?"
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"The idea is that you kill something you need in order to gain higher favours of gods. Human sacrifice is the greatest of sacrifices and it brings the greatest gifts from gods, because you show that you love your gods so much that you are willing to give human life."
                    [/message]
                    [message]
                        speaker=peasant_speaker_2
                        message=_"That sounds very grim."
                    [/message]
                    [message]
                        speaker=she_brother
                        message=_"Where did you learn <i>that</i>? Our gods never spoke about that!"
                    [/message]
                    [message]
                        speaker=mage_speaker
                        message=_"That is what pagans do, Brothers of Light don't have to sacrifice objects and beings to gods because everything we have was given to us by gods and we should not refuse the gifts!"
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"A peasant cares about the crops, fertilises the ground, poisons the weeds. Our food is from peasants, not from gods. A smith makes weapons, a carpenter makes wooden structures. Our tools and buildings are made by humans, not gods. Humans are made by other humans, not by gods. All we possess aren't gifts from gods. Wild animals, trees and mountains might be gifts from them, but we don't sacrifice them as you told."
                    [/message]
                    [message]
                        speaker=Rimaru
                        message=_"I second that idea that gods aren't behind everything, because most things we have were made by humans, but I would never ever use it to justify murder! And not a murder out of hatred or vengeance, but a selfish murder for minor personal gains!"
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"Enough, Rimaru, let me finish my idea. Gods didn't tell us much what we should do and so we should learn from the pagans. They sacrifice and they gain favours. If we sacrificed, we would gain more favours than we're getting now. We need sacrifice to feed the Child with the most precious thing we have, our lives."
                    [/message]
                    [message]
                        speaker=mage_speaker
                        message=_"Do you mean that you're already killing humans before the Child? That's horrible!"
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"It accelerates his growth, makes his powers stronger and brings happiness to his face. He thrives when sacrifices are done."
                    [/message]
                    [message]
                        speaker=mage_speaker
                        message=_"That is incredible!"
                    [/message]
                    [message]
                        speaker=Rimaru
                        message=_"I wonder how would bloody murders give strength to the Divine Child."
                        [option]
                            message=_"Maybe it isn't a Divine Child, but a child of a demon."
                            [command]
                                [message]
                                    speaker=Burke
                                    message=_"A demon in disguise. Interesting, but what else would need human sacrifices?"
                                [/message]
                                [message]
                                    speaker=faithful_lieutenant
                                    message=_"A child of pagan gods?"
                                [/message]
                                [message]
                                    speaker=Rimaru
                                    message=_"Luke, he steals souls, remember?"
                                [/message]
                            [/command]
                        [/option]
                        [option]
                            message=_"What if our gods are more bloodthirsty than we think?"
                            [command]
                                [message]
                                    speaker=Rimaru
                                    message=_"If that is true, I will convert to atheism and force atheism to anybody in this kingdom. Nobody would worship vampire gods."
                                [/message]
                                [message]
                                    speaker=Burke
                                    message=_"We would still need to rip apart the Brothers of Light's order."
                                [/message]
                                [message]
                                    speaker=hired_halberdier
                                    message=_"Yeah, let's do that!"
                                [/message]
                                [message]
                                    speaker=Sicaria
                                    message=_"Guys, think about the fact that Luke steals souls. What is the best way to cover multiple murders? Tell that you're doing it in the name of gods, like any other crimes."
                                [/message]
                            [/command]
                        [/option]
                        [option]
                            message=_"What if Luke is stealing the souls also there and adding all the sacrifice stuff just to legalise it?"
                            [command]
                                [message]
                                    speaker=Rimaru
                                    message=_"That sounds reasonable..."
                                [/message]
                            [/command]
                        [/option]
                    [/message]
                    [message]
                        speaker=Burke
                        message=_"Luke, it's amazing how you have corrupted your order. How excellently you can make up anything to justify any crimes. A person like you is very dangerous and should be sent into the world of the dead."
                    [/message]
                    [message]
                        speaker=mage_speaker
                        message=_"The child is growing stronger from sacrifice! We must practise sacrifice! Thank Luke for his discovery!"
                    [/message]
                    [message]
                        speaker=orc
                        message=_"Idiots. Orcs can be stupid, but humans possess the ability of wilful ignorance that is beyond orcish stupidity."
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"I think that we'll need a sacrifice right now, right here."
                    [/message]
                    [message]
                        speaker=peasant_speaker_1
                        message=_"I have a really grim feeling about this!"
                    [/message]
                    [store_unit]
                        [filter]
                            type=Peasant
                            side=2
                        [/filter]
                        variable=peasants
                        kill=no
                    [/store_unit]
                    {VARIABLE j 100}
                    [while]
                        [variable]
                            name=j
                            greater_than=0
                        [/variable]
                        [do]
                            {VARIABLE_OP j sub 5}
                            [delay]
                                time=200
                            [/delay]
                            [if]
                                [variable]
                                    name=j
                                    equals=60
                                [/variable]
                                [then]
                                    [message]
                                        speaker=peasant_speaker_2
                                        message=_"Argh! Stop that! That is horrible! How can a Brother of Light like you do something like this!"
                                    [/message]
                                    [message]
                                        speaker=Luke
                                        message=_"I am sorry, but it's necessary for my survival and my survival is the only thing that saves you from the darkness these heretics bring."
                                    [/message]
                                [/then]
                            [/if]
                            [if]
                                [variable]
                                    name=j
                                    equals=40
                                [/variable]
                                [then]
                                    [message]
                                        speaker=Sicaria
                                        message=_"Luke, stop eating their souls!"
                                    [/message]
                                    [message]
                                        speaker=Luke
                                        message=_"You enjoyed that, right?"
                                    [/message]
                                    [message]
                                        speaker=Sicaria
                                        message=_"I didn't know that I was eating souls! You told me that I am rewarded by gods for killing unrighteous people! And now you've proven me that I was right that you are a soul stealer and no saviour."
                                    [/message]
                                    [message]
                                        speaker=Luke
                                        message=_"You betrayed me, so I am done with you. I have no need of traitors."
                                    [/message]
                                [/then]
                            [/if]
                            [if]
                                [variable]
                                    name=j
                                    equals=20
                                [/variable]
                                [then]
                                    [message]
                                        speaker=Rimaru
                                        message=_"Luke, stop that! The thing you are doing is the worst evil I have ever seen."
                                    [/message]
                                    [message]
                                        speaker=peasant_speaker_1
                                        message=_"Please, do as he asks!"
                                    [/message]
                                    [message]
                                        speaker=Luke
                                        message=_"I have done things you would see far worse than this. But it's only because you misunderstand the conception of sacrifice."
                                    [/message]
                                    [message]
                                        speaker=mage_speaker
                                        message=_"I will really need to study how this can be righteous when I return."
                                    [/message]
                                    [message]
                                        speaker=Luke
                                        message=_"Believe me, it is needed for the greater good."
                                    [/message]
                                [/then]
                            [/if]
                            [for]
                                array=peasants
                                [do]
                                    [object]
                                        silent=yes
                                        [filter]
                                            id=$peasants[$i].id
                                        [/filter]
                                        [effect]
                                            apply_to=image_mod
                                            replace="O($j%)"
                                        [/effect]
                                    [/object]
                                [/do]
                            [/for]
                        [/do]
                    [/while]
                    {CLEAR_VARIABLE peasants}
                    [kill]
                        type=Peasant
                        side=2
                        animate=no
                        fire_event=no
                    [/kill]
                    [if]
                        [variable]
                            name=party_members.length
                            less_than=9
                        [/variable]
                        [then]
                            [object]
                                [filter]
                                    id=Luke
                                [/filter]
                                silent=yes
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=-30%
                                    heal_full=yes
                                [/effect]
                            [/object]
                        [/then]
                    [/if]
                    [if]
                        [variable]
                            name=party_members.length
                            less_than=4
                        [/variable]
                        [then]
                            [object]
                                [filter]
                                    id=Luke
                                [/filter]
                                silent=yes
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=-30%
                                    heal_full=yes
                                [/effect]
                            [/object]
                        [/then]
                    [/if]
                    [message]
                        speaker=Luke
                        message=_"Now, our gods bestowed upon me the power to destroy you!"
                    [/message]
                    [if]
                        [variable]
                            name=party_members.length
                            less_than=6
                        [/variable]
                        [then]
                            [object]
                                [filter]
                                    id=Luke
                                [/filter]
                                silent=yes
                                [effect]
                                    apply_to=attack
                                    increase_damage=-30%
                                [/effect]
                            [/object]
                        [/then]
                    [/if]
#define BLOOD_RAIN X Y
    [set_variables]
        mode=replace
        name=blood_rain[$blood_rain.length]
        [value]
            x,y={X},{Y}
            side=4
        [/value]
    [/set_variables]
    [item]
        halo=bloodrain/bloodrain-1.png:40,bloodrain/bloodrain-2.png:40,bloodrain/bloodrain-3.png:40,bloodrain/bloodrain-4.png:40,bloodrain/bloodrain-5.png:40,bloodrain/bloodrain-6.png:40,bloodrain/bloodrain-7.png:40,bloodrain/bloodrain-8.png:40,bloodrain/bloodrain-9.png:40,bloodrain/bloodrain-10.png:40
        x,y={X},{Y}
    [/item]
#enddef
                    {BLOOD_RAIN 17 7}
                    {BLOOD_RAIN 15 6}
                    {BLOOD_RAIN 21 5}
                    {BLOOD_RAIN 19 9}
                    {BLOOD_RAIN 18 10}
                    {BLOOD_RAIN 21 11}
                    {BLOOD_RAIN 16 12}
                    {BLOOD_RAIN 20 3}
                    {BLOOD_RAIN 14 6}
                    {BLOOD_RAIN 11 4}
                    {BLOOD_RAIN 13 7}
                    {BLOOD_RAIN 8 5}
                    {BLOOD_RAIN 12 3}
                    {BLOOD_RAIN 5 7}
                    {BLOOD_RAIN 5 10}
                    {BLOOD_RAIN 6 11}
                    {BLOOD_RAIN 10 11}
                    {BLOOD_RAIN 13 14}
                    {BLOOD_RAIN 17 16}
                    {BLOOD_RAIN 19 12}
                    {BLOOD_RAIN 19 15}
                    {BLOOD_RAIN 10 7}
                    {BLOOD_RAIN 13 10}
                    {BLOOD_RAIN 11 6}
                    {BLOOD_RAIN 15 9}
                    {BLOOD_RAIN 9 3}
                    {BLOOD_RAIN 17 3}
                    {BLOOD_RAIN 15 4}
                    {BLOOD_RAIN 23 3}
                    {BLOOD_RAIN 24 6}
                    {BLOOD_RAIN 24 9}
                    {BLOOD_RAIN 22 13}
                    {BLOOD_RAIN 17 12}
#undef BLOOD_RAIN
                    [event]
                        name=victory
                        id=remove_blood_rain_notes
                        {CLEAR_VARIABLE blood_rain}
                    [/event]
                    [event]
                        name=turn refresh
                        first_time_only=no
                        [fire_event]
                            name=blood_rain
                        [/fire_event]
                    [/event]
                    [event]
                        name=blood_rain
                        first_time_only=no
                        [store_side]
                            side=$side_number
                            variable=this_side
                        [/store_side]
                        [for]
                            array=blood_rain
                            [do]
                                [store_side]
                                    side=$blood_rain[$i].side
                                    variable=rain_side
                                [/store_side]
                                [if]
                                    [variable]
                                        name=this_side.team_name
                                        equals=$rain_side.team_name
                                    [/variable]
                                    [then]
                                        [heal_unit]
                                            [filter]
                                                [filter_location]
                                                    x,y=$blood_rain[$i].x,$blood_rain[$i].y
                                                    radius=1
                                                [/filter_location]
                                                side=$side_number
                                            [/filter]
                                            amount=8
                                            animate=yes
                                            restore_statuses=yes
                                        [/heal_unit]
                                    [/then]
                                    [else]
                                        [harm_unit]
                                            [filter]
                                                [filter_location]
                                                    x,y=$blood_rain[$i].x,$blood_rain[$i].y
                                                    radius=1
                                                [/filter_location]
                                                side=$side_number
                                            [/filter]
                                            amount=8
                                            slowed=yes
                                            kill=no
                                        [/harm_unit]
                                    [/else]
                                [/if]
                                {CLEAR_VARIABLE rain_side}
                            [/do]
                        [/for]
                        {CLEAR_VARIABLE this_side}
                    [/event]
                    [message]
                        speaker=she_brother
                        message=_"A rain of blood? It think that it's too obvious that it's something evil!"
                    [/message]
                    [message]
                        speaker=Luke
                        message=_"Besides this cleansing rain, I am also destroying the caves you came from to make sure that you won't flee."
                    [/message]
                    {EARTHQUAKE (
                        [terrain]
                            x,y=8,17
                            terrain=Xu
                        [/terrain]
                        [terrain]
                            x,y=9,17
                            terrain=Ur^Dr
                        [/terrain]
                        [redraw]
                        [/redraw]
                    )}
                    [message]
                        speaker=Rimaru
                        message=_"You will die for this. I will not flee."
                    [/message]
                    {VARIABLE quests.overall 13}
                    [message]
                        speaker=Sicaria
                        message=_"This stupid rain hurts. We'll need to find some spots where it isn't raining so heavily."
                    [/message]
                    [message]
                        speaker=hired_halberdier
                        message=_"I wonder why he didn't try to explain that our goddess is menstruating."
                    [/message]
                    [end_turn]
                    [/end_turn]
                    [event]
                        name=turn refresh
                        [filter]
                            side=4
                        [/filter]
                        [modify_unit]
                            [filter]
                                id=Luke
                            [/filter]
                            moves=0
                            attacks_left=0
                        [/modify_unit]
                    [/event]
                    [event]
                        name=last breath
                        [filter]
                            id=Luke
                        [/filter]
                        [message]
                            speaker=Luke
                            message= _ "Save me, Sicaria, it's me, your old friend and saviour."
                        [/message]
                        [message]
                            speaker=Sicaria
                            message= _ "You saved me and pretended friendship to make me kill many people and do horrible things with their souls."
                        [/message]
                        [message]
                            speaker=Luke
                            message= _ "It isn't forbidden to steal and devour souls."
                        [/message]
                        [message]
                            speaker=Sicaria
                            message= _ "It isn't forbidden because nobody thought somebody would do it. Anyway, I think that it is a kind of desecration of human remains, so it is forbidden. Furthermore, I have just seen you committing a mass murder, which is forbidden. And condemnable. I will not save you, villain."
                        [/message]
                        [message]
                            speaker=Luke
                            message= _ "Save me, former Brother of Light, I will let you join the order again and I will also grant you the title of Master."
                        [/message]
                        [message]
                            speaker=she_brother
                            message= _ "I have left the order voluntarily and your actions only strengthened my belief that my choice was right."
                        [/message]
                        [message]
                            speaker=Rimaru
                            message= _ "I was thinking about leaving the order for long and I left when I was absolutely certain that it was what I wanted."
                        [/message]
                        [message]
                            speaker=Luke
                            message= _ "Your sister is alive."
                        [/message]
                        [message]
                            speaker=Rimaru
                            message= _ "I am aware of that. However, your horrible way of abducting her is even worse than just letting her die. You've persuaded me that I was wrong when I thought you were less bad than you really are."
                        [/message]
                        [message]
                            speaker=Luke
                            message= _ "And you..."
                        [/message]
                        [message]
                            speaker=elf_merc
                            message= _ "If somebody tries to help him, I will pierce his neck with an arrow. I long to take his trinkets."
                        [/message]
                        [message]
                            speaker=Burke
                            message= _ "He's dead!"
                        [/message]
                        {VARIABLE quests.overall 14}
                        [message]
                            speaker=Rimaru
                            message= _ "Now, how do we get out of here? The cave's ceiling crumbled."
                        [/message]
                        [terrain]
                            x,y=24,14
                            terrain=Mm
                        [/terrain]
                        [redraw]
                        [/redraw]
                        [store_unit]
                            [filter]
                                side=1
                            [/filter]
                            variable=side1
                        [/store_unit]
                        {VARIABLE changed_mnt_cost no}
                        [for]
                            array=side1
                            [do]
                                [if]
                                    [variable]
                                        name=side1[$i].movement_costs.mountains
                                        greater_than=0    # not null
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=side1[$i].movement_costs.mountains
                                            less_than=4
                                        [/variable]
                                    [/and]
                                    [else]
                                        {VARIABLE changed_mnt_cost yes}
                                        {VARIABLE helped $side1[$i].id}
                                        [set_variables]
                                            name=side1[$i].modifications.advancement[$side1[$i].modifications.advancement.length]
                                            mode=replace
                                            [value]
                                                id=mountain_passing
                                                [effect]
                                                    apply_to=movement_costs
                                                    replace=true
                                                    [movement_costs]
                                                        mountains=3
                                                    [/movement_costs]
                                                [/effect]
                                            [/value]
                                        [/set_variables]
                                        {VARIABLE side1[$i].movement_costs.mountains 3}
                                        [unstore_unit]
                                            variable=side1[$i]
                                            find_vacant=no
                                        [/unstore_unit]
                                    [/else]
                                [/if]
                            [/do]
                        [/for]
                        {CLEAR_VARIABLE side1}
                        [if]
                            [variable]
                                name=changed_mnt_cost
                                equals=yes
                            [/variable]
                            [then]
                                [message]
                                    speaker=Burke
                                    message= _ "I think that we'll need a heavy hike through the mountains, can all of us pass through mountains?"
                                [/message]
                                [message]
                                    id=$helped
                                    message= _ "I hope I'll manage."
                                [/message]
                                [message]
                                    speaker=Burke
                                    message= _ "That might be too risky. We'll get you out of there. Just find shelter from the accursed rain!"
                                [/message]
                            [/then]
                            [else]
                                [message]
                                    speaker=Burke
                                    message= _ "When the cave is blocked, we'll need to pass through the mountains somehow. Fortunately, none of us has problems with mountains, so let's find a place where the mountains can be crossed. Otherwise, we'll just need to find some shelter from the accursed rain."
                                [/message]
                            [/else]
                        [/if]
                        {CLEAR_VARIABLE changed_mnt_cost,helped}
                        [message]
                            speaker=Sicaria
                            message= _ "And we'll see Konrad then, right?"
                        [/message]
                    [/event]
                [/event]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=28-48,6-21
            side=1
        [/filter]
        {TBC_SPAWN_UNITS_NO_LEADER 3 0.6 "Swordsman,Javelineer,Longbowman,Duelist,Spearman,Bowman,Fencer,Heavy Infantryman,Shock Trooper,Sword Mage,Cavalryman,Dragoon" 38 9}
        {TBC_SPAWN_UNITS_NO_LEADER 4 1.3 "Swordsman,Spearman,Javelineer,Pikeman,Halberdier,Duelist,Master at Arms,Royal Guard,Lieutenant,General" 42 13}
        [message]
            speaker=unit
            message=_"I can hear sounds of battle. Some enemies must have penetrated through the mountains somehow!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=8-32,15-31
            side=1
        [/filter]
        {TBC_SPAWN_UNITS_NO_LEADER 3 0.6 "Swordsman,Javelineer,Longbowman,Duelist,Spearman,Bowman,Fencer,Heavy Infantryman,Shock Trooper,Sword Mage,Cavalryman,Dragoon" 24 21}
        {TBC_SPAWN_UNITS_NO_LEADER 4 1.3 "Swordsman,Javelineer,Pikeman,Halberdier,Duelist,Master at Arms,Fencer,Royal Guard,Lieutenant,General" 19 25}
        [message]
            speaker=unit
            message=_"There is a smaller battle raging! I don't know how these enemies got there, but they are surely capable of doing a lot of harm if they aren't stopped!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=8-17,17-30
            side=1
        [/filter]
        {TBC_SPAWN_UNITS_NO_LEADER 3 0.6 "Swordsman,Javelineer,Longbowman,Duelist,Spearman,Bowman,Fencer,Heavy Infantryman,Shock Trooper,Sword Mage,Cavalryman,Dragoon" 12 29}
        {TBC_SPAWN_UNITS_NO_LEADER 4 1.3 "Swordsman,Spearman,Javelineer,Pilum Master,Pikeman,Halberdier,Duelist,Master at Arms,Fencer,Royal Guard,Lieutenant,General" 9 25}
        [message]
            speaker=unit
            message=_"Some enemies are trying to destroy the local defenders, they must have been following Luke!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=19-48,24-45
            side=1
        [/filter]
        {TBC_SPAWN_UNITS_NO_LEADER 3 0.6 "Swordsman,Javelineer,Longbowman,Duelist,Spearman,Bowman,Fencer,Heavy Infantryman,Shock Trooper,Sword Mage,Cavalryman,Dragoon" 43 28}
        {TBC_SPAWN_UNITS_NO_LEADER 4 1.3 "Swordsman,Spearman,Javelineer,Pikeman,Halberdier,Duelist,Master at Arms,Fencer,Royal Guard,Lieutenant,General" 34 31}
        [message]
            speaker=unit
            message=_"Invaders! Right behind Konrad's fortifications!"
        [/message]
    [/event]

    {TBC_GLOBAL_EVENTS_RPG}
[/scenario]
