#textdomain wesnoth-affably_evil
[scenario]
    id="09_The_Escape"
    name= _ "The Escape"
    map_data="{~add-ons/Affably_Evil/maps/Prison.map}"
    next_scenario=09s_Outro
    victory_when_enemies_defeated=no
    {TURNS 27 25 23}
    {SCENARIO_MUSIC "breaking_the_chains.ogg"}
    {MIDNIGHT}

    [time_area]
        y=0-10
        {INDOORS}
    [/time_area]

    [story]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "They left the dungeons successfully, but outside, they noticed groups of enemy sentries too often and had to flee in a direction they prepared for them. When they realised they were pushed into a trap, they ran into Marilyn and a large group of soldiers."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Marilyn:
Your undead pets caused me a lot of trouble, but eventually, I made it here. I have defeated you, Krux. And it was easy. All I needed was to send a lot of scouts into forests near Strych, you were so predictable at leaving underground as soon as you could. Let me tell you something. Your parents are dead. Both Prion and Balamuthia. Your brothers are dead. I can legally obtain your lands by getting rid of you and marrying your sister. Luckily, you have so many crimes to respond to. Death sentence can be obtained even for a theft, you know?"
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Krux:
I am innocent. You cannot prove my link with the necromancy outbreak."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Marilyn:
That is not so important. I can accuse you of warmongering. Of murder of a soldier you killed in battle. And if we really fail to find something, we can always make up a false accusation. Do not worry. You will die in a few days and I will be your heir."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Acanthamoeba:
Get stuffed. I did not mind marrying you before, but when you have killed everyone I had, I will hate you until I die."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Marilyn:
Fine, fine. You actually do have a choice. Me or gallows. Gallows for Krux are assured, but in your case, I could push the idea that you were a misguided child and promise to help you get rid of your bad manners."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Krux:
Accept that, save your life. If Marilyn and his father Charles die, you would become the heir of both House de Rais and House Mansion."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Marilyn:
I will not die, do not worry. And Krux, who is that lady with you?"
        [/part]
        [if]
            [variable]
                name=quests.took_lucretia
                equals=yes
            [/variable]
            [then]
                [part]
                    show_title=no
                    background=story/capture.jpg
                    story= _ "Krux:
Lucretia? Where is she... she is gone."
                [/part]
                [part]
                    show_title=no
                    background=story/capture.jpg
                    story= _ "Marilyn:
No, I mean the strangely dressed blonde one who looks like an elf."
                [/part]
            [/then]
        [/if]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Krux:
Hm, ehm, well... so... she is a... Ehm, well. I will tell you truth. She is an elf."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Marilyn:
How did she end up with you and in chains?"
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Krux:
She was... hm... she... I have... her... I have abducted her. I cannot accuse her of the things you think I have done because it suits you. Such a shame... I have abducted her in the elvish forest, took her with me. There are some things I like doing with her. Against her will."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Acanthamoeba:
What?"
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Krux:
I had to tell him the truth. There is nothing that can save my life or your freedom. So I just let her go, I am not vengeful. Unlike Marilyn."
        [/part]
        [part]
            show_title=no
            background=story/capture.jpg
            story= _ "Fowleri seemed very surprised. Marilyn untied her and released her. Apparently, he did not want his family to have trouble with elves. Or maybe he seriously believed what Krux said. They were captured and imprisoned."
        [/part]
        [part]
            show_title=no
            background=story/imprisoned.jpg
            story= _ "Krux ended up in an unknown prison. He knew that they wanted to hang him, they did not even let him see his trial. The result of the trial was expectable, death penalty. There was nothing else for him to hope of. He had lost his property, his power, his family, probably also his friends. As the despair of the unavoidably approaching execution strengthened, he felt that he was losing also his mind."
        [/part]
        [part]
            show_title=no
            background=story/hanging.jpg
            story= _ "It did not take long and he was taken to the gallows. He realised where he was, it was on a river beach in Ogira. He was sad that he had not prepared a trick that would help him escape if he was to be hanged there. A crowd of peasants assembled, longing to see someone die. And they were particularly excited because they were told that the man to be hanged was responsible for all their ills. Fowleri also attended, to Krux' surprise."
        [/part]
        [part]
            show_title=no
            background=story/hanging.jpg
            story= _ "He could hear her shouting that he was innocent, that it was his family who was forcing him to do so, that the officials hated him because he did not tolerate embezzlement, that it was all a ruse of the Mansions,... But nobody listened to her. Marilyn was not present, if he was he would have mentioned something like Stockholm syndrome. The closer they were to the execution, the more erratic was her behaviour, as if she was becoming insane... again."
        [/part]
        [part]
            show_title=no
            background=story/hanging-revolt.jpg
            story= _ "She suddenly begun to cast spells. Krux identified some of them as defensive spells, but most of them were not recognisable. Then her spellcasting begun to sound much darker and the guards noticed the bad omen they spread. Then several people near her started screeching, shaking, their clothes tore as some parts of their bodies expanded and they transformed into misshapen ghouls. The hangman became a particularly impressive one."
        [/part]
        [part]
            show_title=no
            background=story/hanging-revolt.jpg
            story= _ "Peasants begun to flee in panic. Guards attacked her and the ghouls, but her protective spells caused that slash wounds afflicted to her were quite shallow and maces caused only large bruises. She killed many, but eventually she fell on the ground, battered unconscious. Krux' execution was postponed. He was accused of bewitching her, but his sentence could not have become any worse. He was taken back to prison."
        [/part]
        [part]
            show_title=no
            background=story/imprisoned.jpg
            story= _ "Fowleri's insane attempt to rescue him gave him some hope, he tried to climb out of the cell hole so that he could attempt to overpower the guards, but the wall was too smooth. Despair returned again, he could only hope that Fowleri would be released as a victim and Acantha would eventually take control of Marilyn, but none of these hopes granted him life. His sanity was draining away, he begun to see things in the darkness."
        [/part]
        [part]
            show_title=no
            background=story/imprisoned.jpg
            story= _ "Then he saw a guard fall next to him to his death. Hallucinating, he saw him rise, his head hanging on a broken neck and his broken legs floating. He heard the cadaver talk about life after death and horrors that it contains, eternal torture that awaits anyone who dies. The nightmare stepped towards him and begun to choke him. Its strength was unmatchable. He struggled a bit, but then he lost conciousness."
        [/part]
        [part]
            show_title=no
            background=story/imprisoned-rescue.jpg
            story= _ "He awoke with Fowleri creeping next to him. She told him to wake up. He opened his eyes. The dead guard's body was lying still and he was being rescued by her. He was not sure if it was a hallucination or not. Without hesitation, Fowleri slapped him across his face a few times to convice him that she was real."
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Krux:
Fowleri... You saved me. May I ask why are you helping me? After all I have done to you."
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Fowleri:
I am Lethalia. Get used to it. I have not saved you yet, we have to get out of the town. And if you want to know my motivation, it is because we used to be in love. Yes, you stole our child for yourself and I have not found him yet, but I am quite certain that you meant it good. Bringing up a half-human child would bring a lot of resentment upon myself. And upon the child too. You humans are more tolerant. And less noticing."
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Krux:
I wanted to tell it to you before..."
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Lethalia:
You have let me live. You have accused yourself of my deeds to free me. Twice. You are a good person. Unlike all those I killed. Anointed knights who cheat on their wives with prostitutes, spend hard-earned wealth of peasants on opulent celebrations and feasts. Mercenaries who slay without thinking and without remorse. Archers who kill for the pleasure of seeing people flee from their arrows' paths. Peasants who beat their wives and children and spend all the scarce family savings on cheap wine."
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Krux:
Did you check everyone you killed?"
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Lethalia:
Almost all of them are like that. Others have other vices that are equally foul. These guards for example were ordered to release me, but before they did so, they checked too much how my dress was torn by their swords and did a lot of other things that were unpleasant to me and pleasant to them. They deserve no mercy. You can kill a human wherever you want, there will always be a reason why should he die. And there is too much of this human filth, I cannot kill everyone. So I will let you live, because we are in love."
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Krux:
Are you insane? Again?"
        [/part]
        [part]
            background=story/imprisoned-rescue.jpg
            story= _ "Lethalia:
I tried to be normal for a while, but I enjoy cleansing the world more than living by its standards. Come, it is time to go. If they raise alarm, we might become unable to deal with them. And there are certainly a few friends of yours that you do not want dead. Try this rope, can you climb ropes?"
        [/part]
    [/story]

    [side]
        type=Krux_father
        id=Krux
        name=_"Krux"
        canrecruit=yes
        unrenamable=yes
        side=1
        controller=human
        recruit=
        village_gold=0
        income=-2
        gold=0
        team_name=house_de_rais
        user_team_name=_"House de Rais"
        shroud=yes
        fog=yes
    [/side]
    [side]
        no_leader=yes
        side=2
        team_name=house_mansion
        user_team_name=_"House Mansion"
        ai_algorithm=idle_ai
    [/side]
    [side]
        no_leader=yes
        side=3
        team_name=house_mansion
        user_team_name=_"House Mansion"
        [ai]
            [goal]
                name=target_location
                [criteria] #NOTE: this is a SLF, because we're targeting a location
                    x,y=20,9
                [/criteria]
                value=20
            [/goal]
        [/ai]
    [/side]
    [side]
        no_leader=yes
        side=4
        team_name=house_mansion
        user_team_name=_"House Mansion"
    [/side]

    [event]
        name=prestart
        {VARIABLE current_scenario the_escape}
        {VARIABLE fowleri_store.side 1}
        {VARIABLE fowleri_store.moves 4}
        {VARIABLE fowleri_store.type Fowleri_batshit}
        {VARIABLE fowleri_store.name _"Lethalia"}
        {VARIABLE fowleri_store.hero yes}
        [unstore_unit]
            variable=fowleri_store
            x,y=5,3
        [/unstore_unit]
        [object]
            silent=yes
            [filter]
                id=Fowleri
            [/filter]
            [effect]
                apply_to=profile
                portrait=portraits/Fowleri_batshit.png
                [filter]
                    type=Fowleri_batshit
                [/filter]
            [/effect]
        [/object]
        #	{ADVANCE_UNIT id=Fowleri Fowleri_batshit}
        {GENERIC_UNIT 1 Ghoul 4 2}
        {GENERIC_UNIT 1 Ghast 7 4}
        {GENERIC_UNIT 1 Necrophage 10 2}
        {GENERIC_UNIT 1 Ghoul 8 4}
        {GENERIC_UNIT 1 Ghast 12 2}
        {GENERIC_UNIT 1 Abomination 7 8}
        {GENERIC_UNIT 1 Ghast 3 7}
#ifndef HARD
        {GENERIC_UNIT 1 Abomination 8 3}
#endif
#ifdef EASY
        {GENERIC_UNIT 1 Necrophage 3 8}
#endif
        [fire_event]
            name=Lethalia update
            [primary_unit]
                id=Lethalia
            [/primary_unit]
        [/fire_event]

        [label]
            x,y=22,11
            text=_"Office for crime reporting"
            color=255,255,255
        [/label]

        [objectives]
            side=1
            [objective]
                description= _ "Reach the park on the south with both leaders"
                condition=win
                [show_if]
                    [not]
                        [have_unit]
                            id=Krux
                            x,y=6-44,29-34
                        [/have_unit]
                        [and]
                            [have_unit]
                                id=Fowleri
                                x,y=6-44,29-34
                            [/have_unit]
                        [/and]
                    [/not]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Kill all witnesses"
                condition=win
                [show_if]
                    [have_unit]
                        side=4
                    [/have_unit]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Kill any guard going to report the events"
                condition=win
                [show_if]
                    [have_unit]
                        side=3
                    [/have_unit]
                [/show_if]
            [/objective]
            [objective]
                description=_ "Death of the Krux or Fowleri/Lethalia"
                condition=lose
            [/objective]
            [objective]
                description=_ "A witness survives"
                condition=lose
            [/objective]
            [objective]
                description=_ "The events are reported"
                condition=lose
            [/objective]
            [objective]
                description=_ "Turns run out"
                condition=lose
            [/objective]
            note=_"Avoid the lit areas to avoid guards. Guards will notice you in a radius of 4 hexes. Check out these objectives (defaults to Ctrl+J) regularly to see if there is not some trouble."
        [/objectives]
    [/event]

    [event]
        name=Lethalia update
        {UPDATE_STATS}
    [/event]

    [event]
        name=start
        [message]
            speaker=Fowleri
            message=_"Fine, you do not seem to be hurt. Free yourself from despair and embrace this only hope of ours."
        [/message]
        [message]
            speaker=Krux
            message=_"We have some undead. But you cannot heal, I cannot heal either, the undead will not regenerate... I fear we will not make it."
        [/message]
        [message]
            speaker=Fowleri
            message=_"We can use stealth. All witnesses of my deeds are dead or turned to undead. There are not many soldiers in this prison, I killed most of them. But the way through the city will be hard, the guards are wandering the town and we need to kill anybody who sees us. We can hide in shadows or bushes. And avoid straying too close to them."
        [/message]
        [message]
            speaker=Krux
            message=_"Can we make more undead?"
        [/message]
        [message]
            speaker=Fowleri
            message=_"We cannot make ghouls. It would need the enemy to stay close to me for longer, but usually they feel the evil power. In prison, it is quite easy, evil powers are common there, in that crowd it was easy too because everyone was focused on your execution, but it will not be usable anymore. I could create walking corpses, but the problem is that the reviving spell reeks of death and makes a dark aura and that would certainly be noticed."
        [/message]
        [message]
            speaker=Krux
            message=_"They have not noticed you on your way here?"
        [/message]
        [message]
            speaker=Fowleri
            message=_"They did not care about me. And the undead were created inside prison. I am now too covered in blood, they will notice."
        [/message]
        [message]
            speaker=Krux
            message=_"So we have to kill all witnesses. Does not seem very pleasant to me, but as long as it can save my life..."
        [/message]
        [message]
            speaker=Fowleri
            message=_"If they notice that you have escaped, they will start a massive search. When you were climbing the rope, I have enchanted the dead soldier to look very much like you. It can be spotted if looked at from short distance and they will notice, but they will not want to loose the reputation for having a dangerous prisoner flee and will hang that imitation of you."
        [/message]
        [message]
            speaker=Krux
            message=_"And how will they explain the number of dead?"
        [/message]
        [message]
            speaker=Fowleri
            message=_"As a failed attempt to flee. You are already known to be a dangerous necromancer."
        [/message]
        [message]
            speaker=Krux
            message=_"I am a reputable necromancer. Without knowing a single necromantic spell."
        [/message]
        [message]
            speaker=Fowleri
            message=_"It is not so hard, I can teach you. But not now."
        [/message]
        [message]
            speaker=Krux
            message=_"How will they learn what they should do? They might not figure out that it would be good to pretend that the enchanted cadaver is me."
        [/message]
        [message]
            speaker=Fowleri
            message=_"I have left a letter. Worry not. We need to get into the park south from prison. The park is dark and borders with forests, so if we get into the park, we are safe."
        [/message]
        [message]
            speaker=Krux
            message=_"You know, I like this new you. Although I think that if you were something between your usual personality and this homicidal maniac, it would be perfect."
        [/message]
        [message]
            speaker=Fowleri
            message=_"I will try. I am also glad that you stopped hypocritically pretending that you are a better person. I have never seen you from the angle that you tried to change humans and killed those who opposed you, because they all deserve death and you were only showing mercy."
        [/message]
        [message]
            speaker=Krux
            message=_"I hope that you will abandon your crusade of purification."
        [/message]
        [message]
            speaker=Fowleri
            message=_"That is how I like you. Let us go! We have to escape before the day breaks."
        [/message]
        {GENERIC_UNIT 2 "Iron Mauler" 23 7}
        {GENERIC_UNIT 2 "Swordsman" 23 3}
        {GENERIC_UNIT 2 "Iron Mauler" 16 2}
        {GENERIC_UNIT 2 "Swordsman" 20 6}
        {GENERIC_UNIT 2 "Pilum Master" 43 13}
        {GENERIC_UNIT 2 "Longbowman" 41 19}
        {GENERIC_UNIT 2 "Pilum Master" 37 8}
        {GENERIC_UNIT 2 "Longbowman" 41 8}
        {GENERIC_UNIT 2 "Master Bowman" 22 25}
        {GENERIC_UNIT 2 "Halberdier" 22 15}
        {GENERIC_UNIT 2 "Javelineer" 3 18}
        {GENERIC_UNIT 2 "Royal Guard" 6 23}
        {GENERIC_UNIT 2 "Swordsman" 8 29}
        {GENERIC_UNIT 2 "Master Bowman" 22 14}
        {GENERIC_UNIT 2 "Halberdier" 8 14}
        {GENERIC_UNIT 2 "Javelineer" 5 21}
        {GENERIC_UNIT 2 "Royal Guard" 2 26}
        {GENERIC_UNIT 2 "Swordsman" 11 25}
        {GENERIC_UNIT 2 "Iron Mauler" 24 23}
        {GENERIC_UNIT 2 "Swordsman" 31 19}
        {GENERIC_UNIT 2 "Pilum Master" 31 28}
#ifndef EASY
        {GENERIC_UNIT 2 "Shock Trooper" 35 25}
        {GENERIC_UNIT 2 "Shock Trooper" 29 15}
        {GENERIC_UNIT 2 "Pikeman" 33 12}
        {GENERIC_UNIT 2 "Pikeman" 37 24}
#endif
#ifdef HARD
        {GENERIC_UNIT 2 "Royal Guard" 36 3}
        {GENERIC_UNIT 2 "Royal Guard" 34 4}
        {GENERIC_UNIT 2 "Iron Mauler" 20 25}
        {GENERIC_UNIT 2 "Iron Mauler" 16 22}
#endif
    [/event]

    [event]
        name=side 2 turn refresh, side 2 turn end
        first_time_only=no
        [store_unit]
            [filter]
                side=2
            [/filter]
            variable=seekers
            kill=no
        [/store_unit]
        [foreach]
            array=seekers
            [do]
                [if]
                    # Passes if a unit of side 1 is in the radius of 4 hexes from the unit (not across the walls) and is either next to a side 2 unit or outside darkness
                    [have_unit]
                        side=1
                        [filter_location]
                            x,y=$this_item.x,$this_item.y
                            radius=4
                            [filter_radius]
                                terrain=!,X*,X*^*,*^X*
                            [/filter_radius]
                        [/filter_location]
                        [and]
                            [filter_adjacent]
                                side=2
                            [/filter_adjacent]
                            [or]
                                [not]
                                    [filter_location]
                                        time_of_day=chaotic
                                    [/filter_location]
                                [/not]
                            [/or]
                            [or]
                                [not]
                                    [filter_wml]
                                        attacks_left=0
                                    [/filter_wml]
                                [/not]
                            [/or]
                        [/and]
                    [/have_unit]
                    [then]
                        [fire_event]
                            name=witnessing
                            [primary_unit]
                                find_in=this_item
                            [/primary_unit]
                        [/fire_event]
                    [/then]
                [/if]
            [/do]
        [/foreach]
    [/event]

    [event]
        name=attack
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [filter_second]
            side=2,4
        [/filter_second]
        [fire_event]
            name=witnessing
            [primary_unit]
                find_in=second_unit
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
        name=witnessing
        first_time_only=no
        [filter]
            side=2,4
        [/filter]
        [if]
            [variable]
                name=unit.side
                equals=4
            [/variable]
            [else]
                [floating_text]
                    text=_ "Necromancers! That villain is trying to escape!"
                    x,y=$x1,$y1
                [/floating_text]
                [unit_overlay]
                    x,y=$x1,$y1
                    image=misc/witness-overlay.png
                [/unit_overlay]
                [modify_unit]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    side=4
                [/modify_unit]
            [/else]
            [then]
                {VARIABLE_OP reports rand "no,no,no,no,no,no,no,no,no,yes"}
                [if]
                    [variable]
                        name=reports
                        equals=yes
                    [/variable]
                    [then]
                        [floating_text]
                            text=_ "I will better report it."
                            x,y=$x1,$y1
                        [/floating_text]
                        [modify_unit]
                            [filter]
                                x,y=$x1,$y1
                            [/filter]
                            side=3
                        [/modify_unit]
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]

    [event]
        name=side 2 turn refresh
        first_time_only=no
        [store_unit]
            [filter]
                side=2
            [/filter]
            variable=wanderer
            kill=no
        [/store_unit]
        [for]
            array=wanderer
            [do]
                {VARIABLE_OP is_wanderer rand "0,1,2,3,4,5,6"}
                [if]
                    [variable]
                        name=is_wanderer
                        equals=1
                    [/variable]
                    [then]
                        {VARIABLE target_x "$(2+$wanderer[$i].x)"}
                        {VARIABLE target_y "$(1+$wanderer[$i].y)"}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=is_wanderer
                        equals=2
                    [/variable]
                    [then]
                        {VARIABLE target_x "$(-2+$wanderer[$i].x)"}
                        {VARIABLE target_y "$(1+$wanderer[$i].y)"}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=is_wanderer
                        equals=3
                    [/variable]
                    [then]
                        {VARIABLE target_x "$wanderer[$i].x"}
                        {VARIABLE target_y "$(3+$wanderer[$i].y)"}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=is_wanderer
                        equals=4
                    [/variable]
                    [then]
                        {VARIABLE target_x "$(2+$wanderer[$i].x)"}
                        {VARIABLE target_y "$(-1+$wanderer[$i].y)"}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=is_wanderer
                        equals=5
                    [/variable]
                    [then]
                        {VARIABLE target_x "$(-2+$wanderer[$i].x)"}
                        {VARIABLE target_y "$(-1+$wanderer[$i].y)"}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=is_wanderer
                        equals=6
                    [/variable]
                    [then]
                        {VARIABLE target_x "$wanderer[$i].x"}
                        {VARIABLE target_y "$(-3+$wanderer[$i].y)"}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=is_wanderer
                        greater_than=0
                    [/variable]
                    [then]
                        [if]
                            [variable]
                                name=target_x
                                less_than=44
                            [/variable]
                            [and]
                                [variable]
                                    name=target_x
                                    greater_than=0
                                [/variable]
                            [/and]
                            [and]
                                [variable]
                                    name=target_y
                                    less_than=34
                                [/variable]
                            [/and]
                            [and]
                                [variable]
                                    name=target_y
                                    greater_than=0
                                [/variable]
                            [/and]
                            [then]
                                [find_path]
                                    [traveler]
                                        id=$wanderer[$i].id
                                    [/traveler]
                                    [destination]
                                        x=$target_x
                                        y=$target_y
                                    [/destination]
                                    variable=path
                                    allow_multiple_turns=yes
                                [/find_path]
                                [if]
                                    [variable]
                                        name=path.hexes
                                        less_than=8
                                    [/variable]
                                    [and]
                                        [variable]
                                            name=path.hexes
                                            greater_than=0
                                        [/variable]
                                    [/and]
                                    [not]
                                        [variable]
                                            name=path.required_turns
                                            greater_than=1
                                        [/variable]
                                    [/not]
                                    [then]
                                        {MOVE_UNIT id=$wanderer[$i].id $target_x $target_y}
                                    [/then]
                                [/if]
                            [/then]
                        [/if]
                        [modify_unit]
                            [filter]
                                id=wanderer[$i].id
                            [/filter]
                            moves=0
                        [/modify_unit]
                    [/then]
                [/if]
            [/do]
        [/for]
        {CLEAR_VARIABLE wanderer,is_wanderer,path,target_x,target_y}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=15-44,1-10
        [/filter]
        [message]
            speaker=Krux
            message=_"We should also save my friends."
        [/message]
        [message]
            speaker=Fowleri
            message=_"I have checked them. All of your friends are either executed or have fled. I do not know."
        [/message]
        [message]
            speaker=Krux
            message=_"And Acantha?"
        [/message]
        [message]
            speaker=Fowleri
            message=_"Acanthamoeba Mansion is currently obeying her loving husband. Do not worry about her, she is a manipulative psychopath like you, she will figure something out."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=3
            x,y=20,9
        [/filter]
        [message]
            speaker=unit
            message=_"Alarm! Krux de Rais is fleeing! Undead are everywhere!"
        [/message]
        [message]
            speaker=Fowleri
            message=_"This is bad."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            canrecruit=yes
            x,y=6-44,29-34
        [/filter]
        [fire_event]
            name=check victory
        [/fire_event]
    [/event]

    [event]
        name=die
        first_time_only=no
        [filter]
            side=3,4
        [/filter]
        [fire_event]
            name=check victory
        [/fire_event]
    [/event]

    [event]
        name=turn refresh
        first_time_only=no
        [fire_event]
            name=check victory
        [/fire_event]
    [/event]

    [event]
        name=check victory
        [filter_condition]
            [have_unit]
                id=Krux
                x,y=6-44,29-34
            [/have_unit]
            [and]
                [have_unit]
                    id=Fowleri
                    x,y=6-44,29-34
                [/have_unit]
            [/and]
            [not]
                [have_unit]
                    side=4
                [/have_unit]
            [/not]
            [not]
                [have_unit]
                    side=3
                [/have_unit]
            [/not]
        [/filter_condition]
        [message]
            speaker=Krux
            message=_"We are fleeing. Great. I was so afraid of that execution. I never thought that I would end up butchering my way out of prison."
        [/message]
        [message]
            speaker=Fowleri
            message=_"They deserved being butchered. It was their fault that they had not listened to reason and sentenced you to death."
        [/message]
        [message]
            speaker=Krux
            message=_"By the way, are you somehow seeing humans as orcs?"
        [/message]
        [message]
            speaker=Fowleri
            message=_"Sometimes. Too many humans are like orcs. If you are not a human, seeing humans as orcs is not so hard."
        [/message]
        [message]
            speaker=Krux
            message=_"You used to be different. Friendly to humans, as far as I know you even served in a human army."
        [/message]
        [message]
            speaker=Fowleri
            message=_"I felt a certain affection towards the human race. You helped me awaken from it. Humans are monsters. You are a cute little monster that should be by my side."
        [/message]
        [message]
            speaker=Krux
            message=_"I somehow think that it is <i>you</i> who is the monster."
        [/message]
        [message]
            speaker=Fowleri
            message=_"I am the one who kills monsters. It is a hard position, because I have to care to avoid becoming a monster myself."
        [/message]
        [message]
            speaker=Krux
            message=_"You <i>already are</i> a monster. But I have to follow you because there is no other place for me. With that reputation I have..."
        [/message]
        [endlevel]
            result=victory
            bonus=no
        [/endlevel]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Fowleri
            message= _ "The daybreak will come in a few moments and we are not done yet. If we run, we might still make it, but we will have to travel somewhere far away to run from our reputation."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    {DISABLE_UPKEEP 1}
    {AE_GLOBAL_EVENTS_STRATEGY}
[/scenario]
