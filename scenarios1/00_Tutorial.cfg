#textdomain wesnoth-loti
[scenario]
    id="00_Tutorial"
    name= _ "Tutorial"
    map_data="{~add-ons/Legend_of_the_Invincibles/maps/00_Tutorial.map}"
    next_scenario="01_An_Orcish_Assault"
    victory_when_enemies_defeated=no
    turns=-1
    {SCENARIO_MUSIC "heroes_rite.ogg"}
    [time]
        id=lit_indoors
        name= _ "Indoors"
        image=misc/time-schedules/schedule-indoors.png
        lawful_bonus=25
    [/time]

    {CHAPTER_TITLE dark_incantation.png 1 "~NOP()" _"<i>Believe me. We have to escape by any means necessary. I do not want to die here.</i> -Lethalia, Queen of Wesnoth"}
    [story]
        [part]
            background=story/countryworld.jpg
            story= _ "Northeast from Lintanir forest, far from the Wesnothian empire, lies a town named Ogira. Life there was quite peaceful due to nearly impassable mountains surrounding them that caused the orcs to choose more accessible targets."
        [/part]
        [part]
            background=story/countryworld.jpg
            story= _ "But one day the good times came to an end. Orcs destroyed everything that was around and had no other targets on their side of the mountains. So they decided to pass through the mountains to raid and destroy everything there. They captured a group of fortifications in the mountains and started raiding from a well fortified base. People started to be afraid of the impending destruction of their homes."
        [/part]
        [part]
            background=story/countryworld.jpg
            story= _ "Efraim de Ceise was a noble fencer who was also proficient with magic. He had studied magic from some books he secretly kept under the false bottom of his chest. Although his skill with a sword was superior, his spells sometimes happened to be useful as well."
        [/part]
    [/story]
    [event]
        name=prestart
        {VARIABLE tutorial.progress 1}
        [objectives]
            side=1
            [objective]
                description= _ "Pick up the sword"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=1
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Collect the gems"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=2
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Craft another sword"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=3
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Store the sword"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=4
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Take the first sword"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=5
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Unstore the other sword and give it to Delenia"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=6
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Make Delenia unequip her armour"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=7
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Drink the potion"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=8
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Defeat Delenia"
                condition=win
                [show_if]
                    [variable]
                        name=tutorial.progress
                        equals=9
                    [/variable]
                [/show_if]
            [/objective]
        [/objectives]
    [/event]

    [side]
        type=09 Fencer
        id=Efraim_de_Ceise
        name=_"Efraim de Ceise"
        side=1
        profile=portraits/Efraim.png
        canrecruit=yes
        controller=human
        gold=0
        income=-2
        recruit=Fencer,Thief,Spearman,Bowman,Heavy Infantryman,Rogue
        team_name=Loyalists
        user_team_name=_"Loyalists"
        unrenamable=yes
        random_traits=yes
        [modifications]
#ifver WESNOTH_VERSION >= 1.13.2
            [advancement]
#else
            [advance]
#endif
                [effect]
                    apply_to=profile
                    portrait=portraits/Efraim.png
                [/effect]
#ifver WESNOTH_VERSION >= 1.13.2
            [/advancement]
#else
            [/advance]
#endif
        [/modifications]
        [unit]
            id=Delenia
            name= _ "Delenia"
            unrenamable=yes
            gender=female
            type=Rogue
            x=18
            y=7
            {IS_HERO}
            random_traits=no
            [modifications]
                {TRAIT_LOYAL}
                [object]
                    name= _ "Leather Armour"
                    image=items/armour-leather.png
                    number=41
                    sort=armour
                    defence=10
                [/object]
            [/modifications]
        [/unit]
    [/side]

    [side]
        no_leader=yes
        side=2
        gold=0
        income=-2
        color=red
        team_name=Outlaws
        user_team_name=_"Outlaws"
    [/side]

    [event]
        name=start
        {UPDATE_ATTACKS 12 7}
        {UPDATE_ATTACKS 18 7}
        [message]
            speaker=Delenia
            message= _ "Hello. I was just walking around, and I decided to see you."
        [/message]
        [message]
            speaker=Efraim_de_Ceise
            message= _ "Hello, Delenia. I was thinking about you. You are a leader of a load of thieves now, am I right?"
        [/message]
        [message]
            speaker=Delenia
            message= _ "Yes. Do you need something stolen?"
        [/message]
        [message]
            speaker=Efraim_de_Ceise
            message= _ "Not exactly. With your support, I have grown a bit more powerful than I was before, and I have some soldiers on my own now. But I have no idea how to command them properly, for the case if these accursed orcs attacked, can you teach me a few things?"
        [/message]
        [message]
            speaker=Delenia
            message= _ "It will be easy. Take that sword there first."
        [/message]
        [item]
            halo=halo/misc/leadership-flare-1.png:20,halo/misc/leadership-flare-2.png:20,halo/misc/leadership-flare-3.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-6.png:20,halo/misc/leadership-flare-7.png:20,halo/misc/leadership-flare-8.png:20,halo/misc/leadership-flare-9.png:20,halo/misc/leadership-flare-10.png:20,halo/misc/leadership-flare-11.png:20,halo/misc/leadership-flare-12.png:20,halo/misc/leadership-flare-13.png:20,misc/blank-hex.png:1000
            x,y=13,6
            image=items/crystal-blade.png
        [/item]
        [event]
            name=moveto
            delayed_variable_substitution=yes
            [filter]
                x,y=13,6
                id=Efraim_de_Ceise
            [/filter]
            {VARIABLE tutorial.proceed 0}
            [while]
                [variable]
                    name=tutorial.proceed
                    equals=0
                [/variable]
                [do]
                    [message]
                        speaker=narrator
                        caption= _ "Sword of Krux"
                        message= _ "<span color='#60A0FF'>Increases blade resistance by 15% </span>
<span color='green'>Damage increased by 3</span>
<span color='green'>Increases all magical damages by 20% </span>
<span color='#808080'><i>Krux has never been a great warrior, deceptive diplomacy was his favourite weapon.</i></span>

Take this item?"
                        image=items/crystal-blade.png
                        [option]
                            message=_ "Take it."
                            [command]
                                {VARIABLE tutorial.proceed 1}
                            [/command]
                        [/option]
                        [option]
                            message= _ "Store it."
                            [command]
                                [message]
                                    speaker=Delenia
                                    message= _ "I told you to take it into your hands, not into your pack."
                                [/message]
                            [/command]
                        [/option]
                        [option]
                            message= _ "Smash it to get a random gem."
                            [command]
                                [message]
                                    speaker=Efraim_de_Ceise
                                    message= _ "No... I should not break it, it is one of the few things that remind me of my father..."
                                [/message]
                            [/command]
                        [/option]
                        [option]
                            message= _ "Leave it on the ground."
                            [command]
                                [message]
                                    speaker=Delenia
                                    message= _ "I told you to take it! You are just soo lazy... Without me, you would be nobody!"
                                [/message]
                            [/command]
                        [/option]
                    [/message]
                [/do]
            [/while]
            {VARIABLE tutorial.progress 2}
            [object]
                [filter]
                    id=Efraim_de_Ceise
                [/filter]
                damage_plus=3
                blade_resist=15
                description= _ "<span color='#60A0FF'>Increases blade resistance by 15% </span>
<span color='green'>Damage increased by 3</span>
<span color='green'>Increases all magical damages by 20% </span>
<span color='#808080'><i>Krux has never been a great warrior, deceptive diplomacy was his favourite weapon.</i></span>"
                image="items/crystal-blade.png"
                magic=20
                name=_"Sword of Krux"
                number=605
                sort="sword"
            [/object]
            [remove_item]
                x,y=13,6
            [/remove_item]
            [store_unit]
                [filter]
                    id=Efraim_de_Ceise
                [/filter]
                variable=advanced2
                kill=yes
            [/store_unit]
            [fire_event]
                name=update_stats
                [primary_unit]
                    id=$advanced2.id
                [/primary_unit]
            [/fire_event]
            [message]
                speaker=Delenia
                message= _ "Fine, fine. Now, take one of the countless swords laying around, for example your previous sword, and bind some magic into it."
            [/message]
            [message]
                speaker=Efraim_de_Ceise
                message= _ "I have some knowledge of magic, but all I know are just some spells, not how to enchant items."
            [/message]
            [message]
                speaker=Delenia
                message= _ "You have to insert some precious gems into it in special constellations."
            [/message]
            [message]
                speaker=Efraim_de_Ceise
                message= _ "So I have to drill some holes into it and try to find a good position?"
            [/message]
            [message]
                speaker=Delenia
                message= _ "No. That would take too much time. I have a book with them somewhere, I will bring it later. Some of them require components worth a king's treasure, some of them are quite cheap to make, but usually the more expensive it is, the better it is. The one I remember requires just three obsidians. Put two of them on one side of the sword, and place the last one into the middle of the line that connects them, on the opposite side of the sword. First, collect these pieces of obsidian."
            [/message]
            {VARIABLE tutorial.obsidians_collected 0}
#define TUTORIAL_PIECE_OF_OBSIDIAN X Y
    [item]
        x,y={X},{Y}
        image=items/obsidian.png
        halo=halo/misc/leadership-flare-1.png:20,halo/misc/leadership-flare-2.png:20,halo/misc/leadership-flare-3.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-6.png:20,halo/misc/leadership-flare-7.png:20,halo/misc/leadership-flare-8.png:20,halo/misc/leadership-flare-9.png:20,halo/misc/leadership-flare-10.png:20,halo/misc/leadership-flare-11.png:20,halo/misc/leadership-flare-12.png:20,halo/misc/leadership-flare-13.png:20,misc/blank-hex.png:1000
    [/item]
    [event]
        name=moveto
        [filter]
            id=Efraim_de_Ceise
            x,y={X},{Y}
        [/filter]
        [remove_item]
            x,y={X},{Y}
            image=items/obsidian.png
        [/remove_item]
        [object]
            name= _ "Obsidian"
            image=items/obsidian.png
            description= _ "Although this gem looks interesting in appearance, its magical power is limited. However, in combination with other gems, it can find some use."
            number=521
            sort=gem
        [/object]
        {VARIABLE_OP tutorial.obsidians_collected add 1}
        [if]
            [variable]
                name=tutorial.obsidians_collected
                equals=3
            [/variable]
            [then]
                [fire_event]
                    name=obsidians_collected
                [/fire_event]
            [/then]
        [/if]
    [/event]
#enddef
            {TUTORIAL_PIECE_OF_OBSIDIAN 12 8}
            {TUTORIAL_PIECE_OF_OBSIDIAN 11 6}
            {TUTORIAL_PIECE_OF_OBSIDIAN 16 6}
#undef TUTORIAL_PIECE_OF_OBSIDIAN X Y
        [/event]
    [/event]
    [event]
        name=obsidians_collected
        {VARIABLE tutorial.progress 3}
        [message]
            speaker=Delenia
            message= _ "Now, you have found enough of them. Put two of them on one side of the sword, and place the last one into the middle of the line that connects them, on the opposite side of the sword."
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Click on Efraim with the right mouse button and select the newly added menu item, and then select the crafting option."
        [/message]
        [set_menu_item]
            id=3dropping
            description=_"Items"
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    id=Efraim_de_Ceise
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE tutorial.proceed 0}
                [while]
                    [variable]
                        name=tutorial.proceed
                        equals=0
                    [/variable]
                    [do]
                        [message]
                            speaker=narrator
                            message= _ "What do you want to do?"
                            [option]
                                message= _ "View the item storage"
                                [command]
                                    [message]
                                        speaker=Delenia
                                        message= _ "No looking into your backpack, there is nothing relevant there anyway."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Crafting"
                                [command]
                                    {VARIABLE tutorial.proceed 1}
                                [/command]
                            [/option]
                            [option]
                                message= _ "Unit information"
                                [command]
                                    [message]
                                        speaker=Efraim_de_Ceise
                                        message= _ "Hm... I do not want her to learn everything about me at the moment."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Remove sword: Sword of Krux:
<span color='#60A0FF'>Increases blade resistance by 15% </span>
<span color='green'>Damage increased by 3</span>
<span color='green'>Increases all magical damages by 20% </span>"
                                [command]
                                    [message]
                                        speaker=Delenia
                                        message= _ "You do not need to throw your sword away to do this."
                                    [/message]
                                [/command]
                            [/option]
                        [/message]
                    [/do]
                [/while]
                {VARIABLE tutorial.proceed 0}
                [while]
                    [variable]
                        name=tutorial.proceed
                        equals=0
                    [/variable]
                    [do]
                        [message]
                            speaker=narrator
                            side_for=$side_number
                            message= _ "What do you want to craft?

Crafted item types are divided into weapons and armour. Weapons can be any weapon type, armour can be a body armour, a helm, a pair of gloves or a pair of boots (helms, gloves and boots receive only 33% of the resistance).

You have:
3 obsidians
0 topazes
0 opals
0 pearls
0 diamonds
0 rubies
0 emeralds
0 amethysts
0 sapphires
0 black pearls"
                            [option]
                                message= _ "Weapon"
                                [command]
                                    {VARIABLE tutorial.proceed 1}
                                [/command]
                            [/option]
                            [option]
                                message= _ "Armour"
                                [command]
                                    [message]
                                        speaker=Delenia
                                        message= _ "I am sorry, I do not remember any crafting constellation for an armour. Try to make a sword instead."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Nothing"
                                [command]
                                    [message]
                                        speaker=Efraim_de_Ceise
                                        message= _ "Wait, I actually want to craft something."
                                    [/message]
                                [/command]
                            [/option]
                        [/message]
                    [/do]
                [/while]
                {VARIABLE tutorial.proceed 0}
                [while]
                    [variable]
                        name=tutorial.proceed
                        equals=0
                    [/variable]
                    [do]
                        [message]
                            speaker=narrator
                            side_for=$side_number
                            message= _ "Choose the item to craft.

<b>Tutorial information: If you lack something, the material you lack and the name of the item will be coloured red to let you know it. At the moment, Delenia has not brought the book about enchantments, so you have only one available, and for that one, you have enough materials at the moment. You only need to have the material, there is no importance in any position or something.</b>"
                            [option]
                                message=_"Exit"
                                [command]
                                    [message]
                                        speaker=Delenia
                                        message= _ "Do not give up easily."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message=_"Twinkling Sword
(3 obsidians)
<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>"
                                [command]
                                    {VARIABLE tutorial.proceed 1}
                                [/command]
                            [/option]
                        [/message]
                    [/do]
                [/while]
                {VARIABLE tutorial.proceed 0}
                [while]
                    [variable]
                        name=tutorial.proceed
                        equals=0
                    [/variable]
                    [do]
                        [message]
                            speaker=narrator
                            side_for=$side_number
                            message= _ "You have chosen to make a Twinkling Sword. Its effects are:
<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>

Material needed:
3 obsidians. You have 3 obsidians.
0 topazes. You have 0 topazes.
0 opals. You have 0 opals.
0 pearls. You have 0 pearls.
0 diamonds. You have 0 diamonds.
0 rubies. You have 0 rubies.
0 emeralds. You have 0 emeralds.
0 amethysts. You have 0 amethysts.
0 sapphires. You have 0 sapphires.
0 black pearls. You have 0 black pearls.

<b>Tutorial information: After finishing the tutorial, you will be able to make more items than just swords.</b>"
                            [option]
                                message= _ "Yes"
                                [command]
                                    {VARIABLE tutorial.proceed 1}
                                [/command]
                            [/option]
                            [option]
                                message= _ "No"
                                [command]
                                    [message]
                                        speaker=Efraim_de_Ceise
                                        message= _ "Wait, I actually want to craft it."
                                    [/message]
                                [/command]
                            [/option]
                        [/message]
                    [/do]
                [/while]
                [object]
                    [filter]
                        id=Efraim_de_Ceise
                    [/filter]
                    name= _ "Twinkling Sword"
                    image=items/sword.png~CS(30,30,70)
                    description= _ "<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>
<span color='#808080'><i>Run towards your enemy and attack sooner than he expects.</i></span>"
                    number=606
                    sort=sword
                    damage=20
                    damage_type=cold
                    cold_resist=15
                    [effect]
                        apply_to=movement
                        increase=2
                    [/effect]
                [/object]
                [store_unit]
                    [filter]
                        id=Efraim_de_Ceise
                    [/filter]
                    variable=advanced2
                    kill=yes
                [/store_unit]
                {FOREACH advanced2.modifications.object i}
                    [if]
                        [variable]
                            name=advanced2.modifications.object[$i].number
                            equals=605
                        [/variable]
                        [then]
                            {CLEAR_VARIABLE advanced2.modifications.object[$i]}
                            {VARIABLE_OP i sub 1}
                        [/then]
                    [/if]
                {NEXT i}
                [unstore_unit]
                    variable=advanced2
                    find_vacant=no
                [/unstore_unit]
                [fire_event]
                    name=update_stats
                    [primary_unit]
                        id=$advanced2.id
                    [/primary_unit]
                [/fire_event]
                [item]
                    halo=halo/misc/leadership-flare-1.png:20,halo/misc/leadership-flare-2.png:20,halo/misc/leadership-flare-3.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-6.png:20,halo/misc/leadership-flare-7.png:20,halo/misc/leadership-flare-8.png:20,halo/misc/leadership-flare-9.png:20,halo/misc/leadership-flare-10.png:20,halo/misc/leadership-flare-11.png:20,halo/misc/leadership-flare-12.png:20,halo/misc/leadership-flare-13.png:20,misc/blank-hex.png:1000
                    x,y=$x1,$y1
                    image=items/crystal-blade.png
                [/item]
                [event]
                    id=dont_take_it
                    name=moveto
                    delayed_variable_substitution=no
                    first_time_only=no
                    [filter]
                        x,y=$x1,$y1
                        id=Efraim_de_Ceise
                    [/filter]
                    [if]
                        [variable]
                            name=tutorial.progress
                            equals=5
                        [/variable]
                        [then]
                            [remove_item]
                                x,y=$x1,$y1
                            [/remove_item]
                            [fire_event]
                                name=take_sword
                            [/fire_event]
                        [/then]
                        [else]
                            [message]
                                speaker=Efraim_de_Ceise
                                message= _ "I was not going to pick it up at the moment."
                            [/message]
                        [/else]
                    [/if]
                [/event]
                [message]
                    speaker=Efraim_de_Ceise
                    message= _ "This sword is not bad, but the previous one was better. I will prefer to take the old one, keeping this one at hand, somebody else might use it. I should put it into my backpack."
                [/message]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "Click on Efraim with the right mouse button, select the newly items menu item, then choose the option to remove the sword."
                [/message]
                {VARIABLE tutorial.progress 4}
                [set_menu_item]
                    id=3dropping
                    description=_"Items"
                    [show_if]
                        [have_unit]
                            x,y=$x1,$y1
                            id=Efraim_de_Ceise
                        [/have_unit]
                    [/show_if]
                    [command]
                        {VARIABLE tutorial.proceed 0}
                        [while]
                            [variable]
                                name=tutorial.proceed
                                equals=0
                            [/variable]
                            [do]
                                [message]
                                    speaker=narrator
                                    message= _ "What do you want to do?"
                                    [option]
                                        message= _ "View the item storage"
                                        [command]
                                            [message]
                                                speaker=Delenia
                                                message= _ "No looking into your backpack, there is nothing relevant there anyway."
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        message= _ "Crafting"
                                        [command]
                                            [message]
                                                speaker=Efraim_de_Ceise
                                                message= _ "I have not found more precious gems anyway..."
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        message= _ "Unit information"
                                        [command]
                                            [message]
                                                speaker=Efraim_de_Ceise
                                                message= _ "Hm... I do not want her to learn everything about me at the moment."
                                            [/message]
                                        [/command]
                                    [/option]
                                    [option]
                                        message= _ "Remove sword: Twinkling Sword:
<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>"
                                        [command]
                                            [message]
                                                speaker=narrator
                                                message= _ "Where should the item go?"
                                                [option]
                                                    message= _ "Into the item storage"
                                                    [command]
                                                        {VARIABLE tutorial.proceed 1}
                                                        {VARIABLE tutorial.progress 5}
                                                        [store_unit]
                                                            [filter]
                                                                id=Efraim_de_Ceise
                                                            [/filter]
                                                            variable=advanced2
                                                            kill=yes
                                                        [/store_unit]
                                                        {FOREACH advanced2.modifications.object i}
                                                            [if]
                                                                [variable]
                                                                    name=advanced2.modifications.object[$i].number
                                                                    equals=606
                                                                [/variable]
                                                                [then]
                                                                    {CLEAR_VARIABLE advanced2.modifications.object[$i]}
                                                                    {VARIABLE_OP i sub 1}
                                                                [/then]
                                                            [/if]
                                                        {NEXT i}
                                                        [unstore_unit]
                                                            variable=advanced2
                                                            find_vacant=no
                                                        [/unstore_unit]
                                                        [fire_event]
                                                            name=update_stats
                                                            [primary_unit]
                                                                id=$advanced2.id
                                                            [/primary_unit]
                                                        [/fire_event]
                                                        [event]
                                                            name=take_sword
                                                            delayed_variable_substitution=no
                                                            {VARIABLE tutorial.proceed 0}
                                                            [event]
                                                                id=dont_take_it
                                                                remove=yes
                                                            [/event]
                                                            [while]
                                                                [variable]
                                                                    name=tutorial.proceed
                                                                    equals=0
                                                                [/variable]
                                                                [do]
                                                                    [message]
                                                                        speaker=narrator
                                                                        caption= _ "Sword of Krux"
                                                                        message= _ "<span color='#60A0FF'>Increases blade resistance by 15% </span>
<span color='green'>Damage increased by 3</span>
<span color='green'>Increases all magical damages by 20% </span>
<span color='#808080'><i>Krux has never been a great warrior, deceptive diplomacy was his favourite weapon.</i></span>

Take this item?"
                                                                        image=items/crystal-blade.png
                                                                        [option]
                                                                            message= _ "Take it."
                                                                            [command]
                                                                                {VARIABLE tutorial.proceed 1}
                                                                            [/command]
                                                                        [/option]
                                                                        [option]
                                                                            message= _ "Store it."
                                                                            [command]
                                                                                [message]
                                                                                    speaker=Efraim_de_Ceise
                                                                                    message= _ "I want to wield that sword in my hands."
                                                                                [/message]
                                                                            [/command]
                                                                        [/option]
                                                                        [option]
                                                                            message= _ "Smash it to get a random gem."
                                                                            [command]
                                                                                [message]
                                                                                    speaker=Efraim_de_Ceise
                                                                                    message= _ "That would be a waste."
                                                                                [/message]
                                                                            [/command]
                                                                        [/option]
                                                                        [option]
                                                                            message= _ "Leave it on the ground."
                                                                            [command]
                                                                                [message]
                                                                                    speaker=Delenia
                                                                                    message= _ "You should be strong enough to be able to carry it..."
                                                                                [/message]
                                                                            [/command]
                                                                        [/option]
                                                                    [/message]
                                                                [/do]
                                                            [/while]
                                                            {VARIABLE tutorial.progress 6}
                                                            [object]
                                                                [filter]
                                                                    id=Efraim_de_Ceise
                                                                [/filter]
                                                                damage_plus=3
                                                                blade_resist=15
                                                                description= _ "<span color='#60A0FF'>Increases blade resistance by 15% </span>
<span color='green'>Damage increased by 3</span>
<span color='green'>Increases all magical damages by 20% </span>
<span color='#808080'><i>Krux has never been a great warrior, deceptive diplomacy was his favourite weapon.</i></span>"
                                                                image="items/crystal-blade.png"
                                                                magic=20
                                                                name=_"Sword of Krux"
                                                                number=605
                                                                sort="sword"
                                                            [/object]
                                                            [store_unit]
                                                                [filter]
                                                                    id=Efraim_de_Ceise
                                                                [/filter]
                                                                variable=advanced2
                                                                kill=yes
                                                            [/store_unit]
                                                            [fire_event]
                                                                name=update_stats
                                                                [primary_unit]
                                                                    id=Efraim_de_Ceise
                                                                [/primary_unit]
                                                            [/fire_event]
                                                            [fire_event]
                                                                name=prepare_to_manip_del
                                                            [/fire_event]
                                                        [/event]
                                                        [message]
                                                            speaker=Delenia
                                                            message= _ "Excellent. Now, you can pick up the old one."
                                                        [/message]
                                                        [set_menu_item]
                                                            id=3dropping
                                                            description= _ "Items"
                                                            [show_if]
                                                                [have_unit]
                                                                    x,y=$x1,$y1
                                                                [/have_unit]
                                                            [/show_if]
                                                            [command]
                                                                [message]
                                                                    speaker=Delenia
                                                                    message= _ "It is on the ground."
                                                                [/message]
                                                            [/command]
                                                        [/set_menu_item]
                                                    [/command]
                                                [/option]
                                                [option]
                                                    message= _ "Into a forge to get a random gem"
                                                    [command]
                                                        [message]
                                                            speaker=Efraim_de_Ceise
                                                            message= _ "I do not need precious gems so badly..."
                                                        [/message]
                                                    [/command]
                                                [/option]
                                                [option]
                                                    message= _ "On the ground"
                                                    [command]
                                                        [message]
                                                            speaker=Delenia
                                                            message= _ "You will be lazy to pick it up then."
                                                        [/message]
                                                    [/command]
                                                [/option]
                                            [/message]
                                        [/command]
                                    [/option]
                                [/message]
                            [/do]
                        [/while]
                    [/command]
                [/set_menu_item]
            [/command]
        [/set_menu_item]
    [/event]
    [event]
        name=prepare_to_manip_del
        [message]
            speaker=Efraim_de_Ceise
            message= _ "I want you to take the sword, as a reward for the lesson."
        [/message]
        [message]
            speaker=Delenia
            message= _ "I do not use swords, I prefer daggers. But I might sell it quite well."
        [/message]
        [message]
            speaker=Efraim_de_Ceise
            message= _ "With a sword, you can hit much harder. And you can also use it to attack somebody from behind using the element of surprise."
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Click on Delenia with the right mouse button, select the newly items menu item, hit item storage and choose to unstore the Twinkling sword."
        [/message]
        [set_menu_item]
            id=3dropping
            description= _ "Items"
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    side=1
                [/have_unit]
            [/show_if]
            [command]
                [if]
                    [variable]
                        name=unit.id
                        equals=Delenia
                    [/variable]
                    [then]
                        [message]
                            speaker=narrator
                            message= _ "What do you want to do?"
                            [option]
                                message= _ "View the item storage"
                                [command]
                                    [message]
                                        speaker=narrator
                                        message= _ "What do you want to unstore? <span color='red'> Keep in mind that after the second turn, you can unstore only items that cannot be unequipped.</span>

<b>Tutorial information: After finishing this tutorial, this will be possible only before turn 2 or on a castle.
This storage is common for all units.</b>"
                                        [option]
                                            message= _ "Exit."
                                            [command]
                                                [message]
                                                    speaker=Efraim_de_Ceise
                                                    message= _ "Heey, I want her to try it out."
                                                [/message]
                                            [/command]
                                        [/option]
                                        [option]
                                            message= _ "Twinkling Sword (sword):
<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>"
                                            [command]
                                                [object]
                                                    [filter]
                                                        id=Delenia
                                                    [/filter]
                                                    name= _ "Twinkling Sword"
                                                    image=items/sword.png~CS(30,30,70)
                                                    description= _ "<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>
<span color='#808080'><i>Run towards your enemy and attack sooner than he expects.</i></span>"
                                                    number=606
                                                    sort=sword
                                                    damage=20
                                                    damage_type=cold
                                                    cold_resist=15
                                                    [effect]
                                                        apply_to=movement
                                                        increase=2
                                                    [/effect]
                                                [/object]
                                                [store_unit]
                                                    [filter]
                                                        id=Delenia
                                                    [/filter]
                                                    variable=advanced2
                                                    kill=yes
                                                [/store_unit]
                                                [fire_event]
                                                    name=update_stats
                                                    [primary_unit]
                                                        id=$advanced2.id
                                                    [/primary_unit]
                                                [/fire_event]
                                                [message]
                                                    speaker=Delenia
                                                    message= _ "Well, if I carry it with me, but not in my hands, I have some benefits of its magical properties granting faster movement. But no other units will agree to take items they are not used to carry."
                                                [/message]
                                                [message]
                                                    speaker=Efraim_de_Ceise
                                                    message= _ "Use the sword to fight, it is much better. You do not need to conceal your weapon, most people know you."
                                                [/message]
                                                [message]
                                                    speaker=Delenia
                                                    message= _ "Hm, maybe..."
                                                [/message]
                                                [message]
                                                    speaker=Efraim_de_Ceise
                                                    message= _ "How about telling you to take that Leather Armour away?"
                                                [/message]
                                                {VARIABLE tutorial.progress 7}
                                                [set_menu_item]
                                                    id=3dropping
                                                    description= _ "Items"
                                                    [show_if]
                                                        [have_unit]
                                                            x,y=$x1,$y1
                                                            side=1
                                                        [/have_unit]
                                                    [/show_if]
                                                    [command]
                                                        [if]
                                                            [variable]
                                                                name=unit.id
                                                                equals=Delenia
                                                            [/variable]
                                                            [then]
                                                                [message]
                                                                    speaker=narrator
                                                                    message= _ "What do you want to do?"
                                                                    [option]
                                                                        message= _ "View the item storage"
                                                                        [command]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "Yes, yes, I never thought you would be such a good person to give me something new."
                                                                            [/message]
                                                                        [/command]
                                                                    [/option]
                                                                    [option]
                                                                        message= _ "Crafting"
                                                                        [command]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "Who cares about crafting now..."
                                                                            [/message]
                                                                        [/command]
                                                                    [/option]
                                                                    [option]
                                                                        message= _ "Unit information"
                                                                        [command]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "I have my secrets!"
                                                                            [/message]
                                                                        [/command]
                                                                    [/option]
                                                                    [option]
                                                                        message= _ "Remove armour: Leather Armour:
<span color='#60A0FF'>Increases physical resistances by 10% </span>"
                                                                        [command]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "This was not meant to be a part of this lesson."
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "I need to learn this too."
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "Do you want to do this with more female comrades? It would be the best way to get defeated."
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "Let us suppose that we are attacking a group of orcish warriors. We have melee fighters and archers, and the fighters are not likely to hit the archers who are protected by melee fighters. It would be useful to move any armours the archers have on the melee fighters. And I should not fail at it, am I right?"
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "I guess your argument is valid, but..."
                                                                            [/message]
                                                                            [set_menu_item]
                                                                                id=3dropping
                                                                                description= _ "Items"
                                                                                [show_if]
                                                                                    [have_unit]
                                                                                        x,y=$x1,$y1
                                                                                    [/have_unit]
                                                                                [/show_if]
                                                                                [command]
                                                                                    [message]
                                                                                        speaker=Delenia
                                                                                        message= _ "Do not delay or I will attack!"
                                                                                    [/message]
                                                                                [/command]
                                                                            [/set_menu_item]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "Take it down!"
                                                                            [/message]
                                                                            [kill]
                                                                                id=Delenia
                                                                                animate=no
                                                                                fire_event=no
                                                                            [/kill]
                                                                            [unit]
                                                                                id=Delenia
                                                                                name= _ "Delenia"
                                                                                unrenamable=yes
                                                                                gender=female
                                                                                type=Delly_start
                                                                                x=18
                                                                                y=7
                                                                                {IS_HERO}
                                                                                side=1
                                                                                random_traits=yes
                                                                                moves=8
                                                                                max_moves=8
                                                                                [modifications]
                                                                                    {TRAIT_LOYAL}
                                                                                    {TRAIT_RESILIENT}
                                                                                    [object]
                                                                                        name= _ "Twinkling Sword"
                                                                                        image=items/sword.png~CS(30,30,70)
                                                                                        description= _ "<span color='green'>Damage increased by 20%</span>
<span color='green'>Sets damage type to: cold </span>
<span color='#60A0FF'>Resist cold 15%</span>
<span color='#60A0FF'>2 more movement points </span>"
                                                                                        number=606
                                                                                        sort=sword
                                                                                        damage=20
                                                                                        damage_type=cold
                                                                                        cold_resist=15
                                                                                        [effect]
                                                                                            apply_to=movement
                                                                                            increase=2
                                                                                        [/effect]
                                                                                    [/object]
                                                                                [/modifications]
                                                                                [attack]
                                                                                    name=sword
                                                                                    description=_"Twinkling Sword"
                                                                                    icon=attacks/sword-human.png
                                                                                    type=cold
                                                                                    range=melee
                                                                                    damage=9
                                                                                    number=4
                                                                                    [specials]
                                                                                        {WEAPON_SPECIAL_BACKSTAB}
                                                                                    [/specials]
                                                                                [/attack]
                                                                                [attack]
                                                                                    name=knife
                                                                                    description=_"knife"
                                                                                    icon=attacks/dagger-thrown-human.png
                                                                                    type=blade
                                                                                    range=ranged
                                                                                    damage=6
                                                                                    number=3
                                                                                [/attack]
                                                                                [resistances]
                                                                                    cold=15
                                                                                [/resistances]
                                                                            [/unit]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "You look much better now. Good looking enough to manipulate every noble... and you even chose to use a sword now..."
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "Because it will be easier to smite you with this sword than with a dagger!"
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "You cannot use your stealth abilities here."
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Delenia
                                                                                message= _ "But I am stronger than you."
                                                                            [/message]
                                                                            [message]
                                                                                speaker=Efraim_de_Ceise
                                                                                message= _ "Wait, let me take that potion there..."
                                                                            [/message]
                                                                            {VARIABLE tutorial.progress 8}
                                                                            [item]
                                                                                halo=halo/misc/leadership-flare-1.png:20,halo/misc/leadership-flare-2.png:20,halo/misc/leadership-flare-3.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-6.png:20,halo/misc/leadership-flare-7.png:20,halo/misc/leadership-flare-8.png:20,halo/misc/leadership-flare-9.png:20,halo/misc/leadership-flare-10.png:20,halo/misc/leadership-flare-11.png:20,halo/misc/leadership-flare-12.png:20,halo/misc/leadership-flare-13.png:20,misc/blank-hex.png:1000
                                                                                x,y=14,11
                                                                                image=items/potion-steel.png
                                                                            [/item]
                                                                            [event]
                                                                                name=moveto
                                                                                [filter]
                                                                                    id=Efraim_de_Ceise
                                                                                    x,y=14,11
                                                                                [/filter]
                                                                                {VARIABLE tutorial.proceed 0}
                                                                                [while]
                                                                                    [variable]
                                                                                        name=tutorial.proceed
                                                                                        equals=0
                                                                                    [/variable]
                                                                                    [do]
                                                                                        [message]
                                                                                            speaker=narrator
                                                                                            caption= _ "Potion of Steel Skin"
                                                                                            message= _ "<span color='orange'>Increases physical resistances by 25% </span>
<span color='#808080'><i>Only magic can make steel bend easily only when needed. Or not?</i></span>

Take this item?

<b>Tutorial Information: The effects of potions wear off as soon as the unit advances, no matter how many scenarios pass.</b>"
                                                                                            image=items/potion-steel.png
                                                                                            [option]
                                                                                                message= _ "Take it."
                                                                                                [command]
                                                                                                    {VARIABLE tutorial.proceed 1}
                                                                                                [/command]
                                                                                            [/option]
                                                                                            [option]
                                                                                                message= _ "Store it."
                                                                                                [command]
                                                                                                    [message]
                                                                                                        speaker=Delenia
                                                                                                        message= _ "Haha, and you wanted to fight me?"
                                                                                                    [/message]
                                                                                                [/command]
                                                                                            [/option]
                                                                                            [option]
                                                                                                message= _ "Leave it on the ground."
                                                                                                [command]
                                                                                                    [message]
                                                                                                        speaker=Delenia
                                                                                                        message= _ "Heh, you will lose."
                                                                                                    [/message]
                                                                                                [/command]
                                                                                            [/option]
                                                                                        [/message]
                                                                                    [/do]
                                                                                [/while]
                                                                                {VARIABLE tutorial.progress 9}
                                                                                [object]
                                                                                    [filter]
                                                                                        id=Efraim_de_Ceise
                                                                                    [/filter]
                                                                                    name= _ "Potion of Steel Skin"
                                                                                    image=items/potion-steel.png
                                                                                    description= _ "<span color='orange'>Increases physical resistances by 25%</span>
<span color='#808080'><i>Only magic can make steel bend easily only when needed. Or not?</i></span>"
                                                                                    number=130
                                                                                    sort=potion
                                                                                    defence=25
                                                                                [/object]
                                                                                [remove_item]
                                                                                    x,y=14,11
                                                                                    image=items/potion-steel.png
                                                                                [/remove_item]
                                                                                [store_unit]
                                                                                    [filter]
                                                                                        id=Efraim_de_Ceise
                                                                                    [/filter]
                                                                                    variable=advanced2
                                                                                    kill=yes
                                                                                [/store_unit]
                                                                                [fire_event]
                                                                                    name=update_stats
                                                                                    [primary_unit]
                                                                                        id=Efraim_de_Ceise
                                                                                    [/primary_unit]
                                                                                [/fire_event]
                                                                                [modify_unit]
                                                                                    [filter]
                                                                                        id=Delenia
                                                                                    [/filter]
                                                                                    side=2
                                                                                    moves=5
                                                                                [/modify_unit]
                                                                                [event]
                                                                                    id=delly_freeze
                                                                                    remove=yes
                                                                                [/event]
                                                                                [set_menu_item]
                                                                                    id=3dropping
                                                                                    description= _ "Items"
                                                                                    [show_if]
                                                                                        [have_unit]
                                                                                            x,y=$x1,$y1
                                                                                        [/have_unit]
                                                                                    [/show_if]
                                                                                    [command]
                                                                                        [message]
                                                                                            speaker=Delenia
                                                                                            message= _ "It is too late to switch gear now!"
                                                                                        [/message]
                                                                                    [/command]
                                                                                [/set_menu_item]
                                                                                [message]
                                                                                    speaker=Efraim_de_Ceise
                                                                                    message= _ "En garde!"
                                                                                [/message]
                                                                            [/event]
                                                                        [/command]
                                                                    [/option]
                                                                [/message]
                                                            [/then]
                                                            [else]
                                                                [message]
                                                                    speaker=Efraim_de_Ceise
                                                                    message= _ "Take her armour down, not mine."
                                                                [/message]
                                                            [/else]
                                                        [/if]
                                                    [/command]
                                                [/set_menu_item]
                                            [/command]
                                        [/option]
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Crafting"
                                [command]
                                    [message]
                                        speaker=Efraim_de_Ceise
                                        message= _ "The only item we can make is quite useless..."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Unit information"
                                [command]
                                    [message]
                                        speaker=Delenia
                                        message= _ "What would you like to know? Surely something you should not know..."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Remove armour: Leather Armour:
<span color='#60A0FF'>Increases physical resistances by 10% </span>"
                                [command]
                                    [message]
                                        speaker=Delenia
                                        message= _ "No, no, no, no..."
                                    [/message]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Delenia
                            message= _ "Are you such a narcissist that you want to gift me by giving a sword to yourself?"
                        [/message]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
    [/event]

    [event]
        name=turn refresh
        id=delly_freeze
        [modify_unit]
            [filter]
                id=Delenia
            [/filter]
            moves=0
        [/modify_unit]
    [/event]
#define TUTORIAL_PATH_BLOCK_EVENT RANGE
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Efraim_de_Ceise
            x,y={RANGE}
        [/filter]
        [message]
            speaker=Delenia
            message= _ "Do you need to take a refreshing drink?"
        [/message]
        {MOVE_UNIT id=Efraim_de_Ceise $x2 $y2}
    [/event]
#enddef
    {TUTORIAL_PATH_BLOCK_EVENT 13-26,22-26}
    {TUTORIAL_PATH_BLOCK_EVENT 3-12,15-16}
    {TUTORIAL_PATH_BLOCK_EVENT 24-27,1-2}
    {TUTORIAL_PATH_BLOCK_EVENT 1-4,1-4}
#undef TUTORIAL_PATH_BLOCK_EVENT
    [event]
        name=attack end
        [message]
            speaker=Delenia
            message= _ "Something is going on, we should better stop fighting and go to check it out."
        [/message]
        [modify_unit]
            [filter]
                id=Delenia
            [/filter]
            side=1
        [/modify_unit]
        [message]
            speaker=Efraim_de_Ceise
            message= _ "Oh, no! This should not be happening! The bell you can hear sounds like the signal of an orcish invasion. It seems that your lessons will be very useful."
        [/message]
        [endlevel]
            result=victory
            bonus=no
        [/endlevel]
    [/event]
    [event]
        name=update_stats
        first_time_only=no
        {BACKUP_UNIT_STATS}
        {CALCULATE_WEAPONS_ONLY}
        {CALCULATE_LAST_THINGS}
        {CALCULATIONS_END}
    [/event]

    experience_modifier=125
[/scenario]
